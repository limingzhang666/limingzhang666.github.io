<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="HCj467TtuvFkAzzdCvYvbniAeNiUy7TUwp2hG1qGWQE">
  <meta name="baidu-site-verification" content="LppFIbSdZO">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"limingzhang666.github.io","root":"/","images":"/images","scheme":"Muse","version":"8.0.2","exturl":false,"sidebar":{"position":"left","width":320,"display":"always","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":3,"unescape":false,"preload":false}};
  </script>

  <meta name="description" content="背景最近有个业务需求，功能是：要通过excel 装载大量数据并上传至系统，excel的格式是.xlsx,后台需要解析excel的每条数据，进行一系列 有效性以及权限等校验。验证通过的需要落数据库， 验证不通过的需要 生成一个异常数据的excel，将每条数据的错误原因 备注在 源数据的最后一列 。 其实举个例子，比如 5w条数据放在excel，excel的大小大概是 2M左右，在放在List里面不算">
<meta property="og:type" content="article">
<meta property="og:title" content="读取poi大文件的两种方案">
<meta property="og:url" content="https://limingzhang666.github.io/2021/03/28/%E8%AF%BB%E5%8F%96poi%E5%A4%A7%E6%96%87%E4%BB%B6%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E6%A1%88/index.html">
<meta property="og:site_name" content="Yinshi&#39;s Blog">
<meta property="og:description" content="背景最近有个业务需求，功能是：要通过excel 装载大量数据并上传至系统，excel的格式是.xlsx,后台需要解析excel的每条数据，进行一系列 有效性以及权限等校验。验证通过的需要落数据库， 验证不通过的需要 生成一个异常数据的excel，将每条数据的错误原因 备注在 源数据的最后一列 。 其实举个例子，比如 5w条数据放在excel，excel的大小大概是 2M左右，在放在List里面不算">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://limingzhang666.github.io/uploads/poiJVM/excelSize.png">
<meta property="og:image" content="https://limingzhang666.github.io/uploads/poiJVM/userModelJVM.png">
<meta property="og:image" content="https://limingzhang666.github.io/uploads/poiJVM/SaxPOI_JVMparams.png">
<meta property="og:image" content="https://limingzhang666.github.io/uploads/poiJVM/ali_easyExcel_JVM.png">
<meta property="article:published_time" content="2021-03-28T07:51:16.000Z">
<meta property="article:modified_time" content="2021-04-14T06:13:31.923Z">
<meta property="article:author" content="Yinshi">
<meta property="article:tag" content="读取大文件">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://limingzhang666.github.io/uploads/poiJVM/excelSize.png">


<link rel="canonical" href="https://limingzhang666.github.io/2021/03/28/%E8%AF%BB%E5%8F%96poi%E5%A4%A7%E6%96%87%E4%BB%B6%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E6%A1%88/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>读取poi大文件的两种方案 | Yinshi's Blog</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Yinshi's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-guestbook">

    <a href="/guestbook" rel="section"><i class="fa fa-book fa-fw"></i>留言</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <section class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%83%8C%E6%99%AF"><span class="nav-number">1.</span> <span class="nav-text">背景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%B9%E6%A1%88"><span class="nav-number">2.</span> <span class="nav-text">方案</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%A1%881%EF%BC%9Apoi%E4%BA%8B%E4%BB%B6%E6%A8%A1%E5%BC%8F-%E5%88%86%E9%A1%B5%E5%A4%84%E7%90%86"><span class="nav-number">2.1.</span> <span class="nav-text">方案1：poi事件模式+分页处理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96%E5%8C%85"><span class="nav-number">2.1.1.</span> <span class="nav-text">依赖包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96excel-%E7%9A%84%E6%80%BB%E8%A1%8C%E6%95%B0"><span class="nav-number">2.1.2.</span> <span class="nav-text">获取excel 的总行数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E9%A1%B5%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="nav-number">2.1.3.</span> <span class="nav-text">分页获取数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E8%A1%8C%E8%BD%AC%E5%AF%B9%E8%B1%A1Handler"><span class="nav-number">2.1.4.</span> <span class="nav-text">数据行转对象Handler</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BE%85%E5%8A%A9%E7%B1%BB"><span class="nav-number">2.1.5.</span> <span class="nav-text">辅助类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%B9%E5%A4%96%E6%8F%90%E4%BE%9B%E6%9C%8D%E5%8A%A1%E7%B1%BB"><span class="nav-number">2.1.6.</span> <span class="nav-text">对外提供服务类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A"><span class="nav-number">2.1.7.</span> <span class="nav-text">总结：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%A1%882%EF%BC%9A%E6%B5%81%E5%BC%8F%E5%A4%84%E7%90%86"><span class="nav-number">2.2.</span> <span class="nav-text">方案2：流式处理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96%E5%8C%85-1"><span class="nav-number">2.2.1.</span> <span class="nav-text">依赖包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F%EF%BC%9A"><span class="nav-number">2.2.2.</span> <span class="nav-text">使用方式：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A-1"><span class="nav-number">2.2.3.</span> <span class="nav-text">总结：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%A1%883%EF%BC%9A-%E9%98%BF%E9%87%8CeasyExcel"><span class="nav-number">2.3.</span> <span class="nav-text">方案3： 阿里easyExcel</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E6%9E%90%EF%BC%9A"><span class="nav-number">2.3.1.</span> <span class="nav-text">分析：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9C%80%E6%B1%82%EF%BC%9A"><span class="nav-number">2.3.2.</span> <span class="nav-text">需求：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%EF%BC%9A"><span class="nav-number">2.3.3.</span> <span class="nav-text">实现：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96%E5%8C%85-2"><span class="nav-number">2.3.4.</span> <span class="nav-text">依赖包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89LIstener"><span class="nav-number">2.3.5.</span> <span class="nav-text">自定义LIstener</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A-2"><span class="nav-number">2.3.6.</span> <span class="nav-text">总结：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">2.4.</span> <span class="nav-text">总结</span></a></li></ol></li></ol></div>
        </section>
        <!--/noindex-->

        <section class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Yinshi"
      src="/images/yinshi01_avatar.jpg">
  <p class="site-author-name" itemprop="name">Yinshi</p>
  <div class="site-description" itemprop="description">拨开云雾见青天</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">69</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">73</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/limingzhang666" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;limingzhang666" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:laimingcham@163.com" title="E-Mail → mailto:laimingcham@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



        </section>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/limingzhang666" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">
      

      

  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://limingzhang666.github.io/2021/03/28/%E8%AF%BB%E5%8F%96poi%E5%A4%A7%E6%96%87%E4%BB%B6%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E6%A1%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/yinshi01_avatar.jpg">
      <meta itemprop="name" content="Yinshi">
      <meta itemprop="description" content="拨开云雾见青天">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yinshi's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          读取poi大文件的两种方案
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-03-28 15:51:16" itemprop="dateCreated datePublished" datetime="2021-03-28T15:51:16+08:00">2021-03-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/poi/" itemprop="url" rel="index"><span itemprop="name">poi</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/03/28/%E8%AF%BB%E5%8F%96poi%E5%A4%A7%E6%96%87%E4%BB%B6%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E6%A1%88/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/03/28/%E8%AF%BB%E5%8F%96poi%E5%A4%A7%E6%96%87%E4%BB%B6%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E6%A1%88/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>57k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>52 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>最近有个业务需求，功能是：要通过excel 装载大量数据并上传至系统，excel的格式是.xlsx,后台需要解析excel的每条数据，进行一系列 有效性以及权限等校验。<br>验证通过的需要落数据库， 验证不通过的需要 生成一个异常数据的excel，将每条数据的错误原因 备注在 源数据的最后一列 。</p>
<p>其实举个例子，比如 5w条数据放在excel，excel的大小大概是 2M左右，在放在List里面不算大，可是使用用户模式POI去一次性解析放在List<T>中，这个过程 需要的内存肯定是 20M 往上， 10倍都是保守估计， 所以不要看excel文件不大，解析可是非常耗内存的， 可能是 xlsx的功能太多了，文件格式 太复杂了</p>
<p>所以建议当数据量大的时候，使用.csv的文件去上传， 因为csv 可以使用excel打开，也可以用文本打开，单元格数据用的 逗号隔开的， 只需要用splitBy 逗号就行了，很便捷 </p>
<h2 id="方案"><a href="#方案" class="headerlink" title="方案"></a>方案</h2><p>其实如果数据量不大的情况下，我们 可以使用简单的poi 将excel 一次性加载至内存中，然后逐条数据一次解析验证 。</p>
<p>可是当 excel 的数据量特别大的时候，就有可能发生OOM的情况，系统直接就卡死了。这是我们不能容忍的 。解决这个问题的方案这边其实有3种：</p>
<h3 id="方案1：poi事件模式-分页处理"><a href="#方案1：poi事件模式-分页处理" class="headerlink" title="方案1：poi事件模式+分页处理"></a>方案1：poi事件模式+分页处理</h3><p>看poi的文档，其实poi 的api提供了2种 模式，</p>
<ul>
<li>一种就是我们常用的用户模式usermodel，就是将excel的内容一次性全部加载至 内存中，</li>
<li>还有一种用的是 事件模式，因为其实将 的excel文件后缀名.xlsx 改为 .zip，打开zip包 就可以知道其实excel的底层数据是以 xml的形式存储的。所以 事件模式就是 使用sax解析excel 。</li>
</ul>
<p>poi提供一套api去处理 解析过程，这个api对用户不是很友好，有点晦涩难懂，我们可以通过自行封装这一套 api然后  进行分页paging 分批的去读取数据到内存中  如下所示：</p>
<h4 id="依赖包"><a href="#依赖包" class="headerlink" title="依赖包"></a>依赖包</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;joda-time&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;joda-time&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.9.8&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- apache poi 操作Microsoft Document --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;poi&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.17&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- Apache POI - Java API To Access Microsoft Format Files--&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;poi-ooxml&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.17&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- Apache POI - Java API To Access Microsoft Format Files--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;poi-ooxml-schemas&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.17&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- poi eventmodel方式 依赖包 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;xerces&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;xercesImpl&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.11.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>



<h4 id="获取excel-的总行数"><a href="#获取excel-的总行数" class="headerlink" title="获取excel 的总行数"></a>获取excel 的总行数</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yinshi.gitstats.poi.sax;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.poi.openxml4j.opc.OPCPackage;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.xssf.eventusermodel.XSSFReader;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.xssf.model.SharedStringsTable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.xml.sax.Attributes;</span><br><span class="line"><span class="keyword">import</span> org.xml.sax.ContentHandler;</span><br><span class="line"><span class="keyword">import</span> org.xml.sax.InputSource;</span><br><span class="line"><span class="keyword">import</span> org.xml.sax.SAXException;</span><br><span class="line"><span class="keyword">import</span> org.xml.sax.XMLReader;</span><br><span class="line"><span class="keyword">import</span> org.xml.sax.helpers.DefaultHandler;</span><br><span class="line"><span class="keyword">import</span> org.xml.sax.helpers.XMLReaderFactory;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * XSSF and SAX (Event API) basic example.</span></span><br><span class="line"><span class="comment"> * See &#123;<span class="doctag">@link</span> XLSX2CSV&#125; for a fuller example of doing</span></span><br><span class="line"><span class="comment"> *  XSLX processing with the XSSF Event code.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyExcel2007ForMaxRow</span> </span>&#123;</span><br><span class="line">    <span class="comment">//new add</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">long</span> maxRow = <span class="number">0</span>;<span class="comment">//记录总行数</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String filename = <span class="keyword">null</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyExcel2007ForMaxRow</span><span class="params">(String filename)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(filename)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;文件名不能空&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.filename = filename;</span><br><span class="line">        processFirstSheet();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 指定获取第一个sheet</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">processFirstSheet</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        OPCPackage pkg = OPCPackage.open(filename);</span><br><span class="line">        XSSFReader r = <span class="keyword">new</span> XSSFReader( pkg );</span><br><span class="line">        SharedStringsTable sst = r.getSharedStringsTable();</span><br><span class="line"></span><br><span class="line">        XMLReader parser = fetchSheetParser(sst);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// To look up the Sheet Name / Sheet Order / rID,</span></span><br><span class="line">        <span class="comment">//  you need to process the core Workbook stream.</span></span><br><span class="line">        <span class="comment">// Normally it&#x27;s of the form rId# or rSheet#</span></span><br><span class="line">        InputStream sheet2 = r.getSheet(<span class="string">&quot;rId1&quot;</span>);</span><br><span class="line">        InputSource sheetSource = <span class="keyword">new</span> InputSource(sheet2);</span><br><span class="line">        parser.parse(sheetSource);</span><br><span class="line">        sheet2.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> XMLReader <span class="title">fetchSheetParser</span><span class="params">(SharedStringsTable sst)</span> <span class="keyword">throws</span> SAXException </span>&#123;</span><br><span class="line">        XMLReader parser =</span><br><span class="line">                XMLReaderFactory.createXMLReader(</span><br><span class="line">                        <span class="string">&quot;org.apache.xerces.parsers.SAXParser&quot;</span></span><br><span class="line">                );</span><br><span class="line">        ContentHandler handler = <span class="keyword">new</span> MaxRowHandler();</span><br><span class="line">        parser.setContentHandler(handler);</span><br><span class="line">        <span class="keyword">return</span> parser;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * See org.xml.sax.helpers.DefaultHandler javadocs</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span>  <span class="class"><span class="keyword">class</span> <span class="title">MaxRowHandler</span> <span class="keyword">extends</span> <span class="title">DefaultHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startElement</span><span class="params">(String uri, String localName, String name,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 Attributes attributes)</span> <span class="keyword">throws</span> SAXException </span>&#123;</span><br><span class="line">            <span class="comment">// c =&gt; cell</span></span><br><span class="line">            <span class="keyword">if</span>(name.equals(<span class="string">&quot;c&quot;</span>)) &#123;</span><br><span class="line">                String index = attributes.getValue(<span class="string">&quot;r&quot;</span>);</span><br><span class="line">                <span class="keyword">if</span>(Pattern.compile(<span class="string">&quot;A[0-9]+$&quot;</span>).matcher(index).find())&#123;</span><br><span class="line">                    maxRow++;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        MyExcel2007ForMaxRow reader = <span class="keyword">new</span> MyExcel2007ForMaxRow(<span class="string">&quot;/home/yinshi/Documents/CodeSource/test-write07.xlsx&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;\n---&quot;</span>+reader.maxRow);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="分页获取数据"><a href="#分页获取数据" class="headerlink" title="分页获取数据"></a>分页获取数据</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yinshi.gitstats.poi.sax;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yinshi.gitstats.entity.TmCase;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.openxml4j.opc.OPCPackage;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.xssf.eventusermodel.XSSFReader;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.xssf.model.SharedStringsTable;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.xssf.usermodel.XSSFRichTextString;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.xml.sax.*;</span><br><span class="line"><span class="keyword">import</span> org.xml.sax.helpers.DefaultHandler;</span><br><span class="line"><span class="keyword">import</span> org.xml.sax.helpers.XMLReaderFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * XSSF and SAX (Event API) basic example.</span></span><br><span class="line"><span class="comment"> * See &#123;<span class="doctag">@link</span> XLSX2CSV&#125; for a fuller</span></span><br><span class="line"><span class="comment"> * example of doing XSLX processing with the XSSF Event code.</span></span><br><span class="line"><span class="comment"> * 目前函数又个缺陷，便是starElement函数中发现新行的策略有问题</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyExcel2007ForPaging_high_baK_bak</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    @Autowired</span></span><br><span class="line"><span class="comment">//    private TmCaseRepo tmCaseRepo;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 代表Excel中必须有值的起始列(A、B、C....AA、AB...)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String indexC4Data = <span class="string">&quot;A&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 存储所有行的值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;IndexValue&gt;&gt; dataList = <span class="keyword">new</span> ArrayList&lt;List&lt;IndexValue&gt;&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 临时存储当前行的值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;IndexValue&gt; rowData;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> startRow;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> endRow;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> currentRow = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String filename;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 一行文件有几个字段（列的数量）</span></span><br><span class="line"><span class="comment">     * 首先需要 xlsx 的excel文件的header有几个字段，建议还是手动传进来，</span></span><br><span class="line"><span class="comment">     * 1. 场景：防止一些没有header的文件，</span></span><br><span class="line"><span class="comment">     * 2. 场景： 如果一行有9列，其中第4列之后就再也没有值了，后（9-4）=5个字段，就需要手动补充空格了，否则将list转为对象vo的时候，</span></span><br><span class="line"><span class="comment">     * 容易数组越界异常，建议还是在这里给它补充完成 ，如果不在这里补充完整，也可以在 list转vo的时候，把list的剩余字段补上</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> columnSize;</span><br><span class="line"><span class="comment">//    private int startRow;</span></span><br><span class="line"><span class="comment">//    private int endRow;</span></span><br><span class="line"><span class="comment">//    private int currentRow = 0;</span></span><br><span class="line"><span class="comment">//    private String filename;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//    //    @PostConstruct</span></span><br><span class="line"><span class="comment">//    private void init(String filename, int startRow, int endRow) throws Exception &#123;</span></span><br><span class="line"><span class="comment">//        if (StringUtils.isEmpty(filename)) &#123;</span></span><br><span class="line"><span class="comment">//            throw new Exception(&quot;文件名不能空&quot;);</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"><span class="comment">//        this.filename = filename;</span></span><br><span class="line"><span class="comment">//        this.startRow = startRow;</span></span><br><span class="line"><span class="comment">//        this.endRow = endRow;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyExcel2007ForPaging_high_baK_bak</span><span class="params">(String filename, <span class="keyword">int</span> columnSize, <span class="keyword">int</span> startRow, <span class="keyword">int</span> endRow)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(filename)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;文件名不能空&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.columnSize = columnSize;</span><br><span class="line">        <span class="keyword">this</span>.filename = filename;</span><br><span class="line">        <span class="keyword">this</span>.startRow = startRow;</span><br><span class="line">        <span class="keyword">this</span>.endRow = endRow;</span><br><span class="line">        processFirstSheet();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 指定获取第一个sheet</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processFirstSheet</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//        init(filename,startRow,endRow);</span></span><br><span class="line"></span><br><span class="line">        OPCPackage pkg = OPCPackage.open(filename);</span><br><span class="line">        XSSFReader r = <span class="keyword">new</span> XSSFReader(pkg);</span><br><span class="line">        SharedStringsTable sst = r.getSharedStringsTable();</span><br><span class="line"></span><br><span class="line">        XMLReader parser = fetchSheetParser(sst);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// To look up the Sheet Name / Sheet Order / rID,</span></span><br><span class="line">        <span class="comment">// you need to process the core Workbook stream.</span></span><br><span class="line">        <span class="comment">// Normally it&#x27;s of the form rId# or rSheet#</span></span><br><span class="line">        InputStream sheet1 = r.getSheet(<span class="string">&quot;rId1&quot;</span>);</span><br><span class="line">        InputSource sheetSource = <span class="keyword">new</span> InputSource(sheet1);</span><br><span class="line">        parser.parse(sheetSource);</span><br><span class="line">        sheet1.close();</span><br><span class="line">        pkg.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> XMLReader <span class="title">fetchSheetParser</span><span class="params">(SharedStringsTable sst)</span> <span class="keyword">throws</span> SAXException </span>&#123;</span><br><span class="line">        XMLReader parser = XMLReaderFactory.createXMLReader(<span class="string">&quot;org.apache.xerces.parsers.SAXParser&quot;</span>);</span><br><span class="line">        ContentHandler handler = <span class="keyword">new</span> PagingHandler(sst);</span><br><span class="line">        parser.setContentHandler(handler);</span><br><span class="line">        <span class="keyword">return</span> parser;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * See org.xml.sax.helpers.DefaultHandler javadocs</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">PagingHandler</span> <span class="keyword">extends</span> <span class="title">DefaultHandler</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> SharedStringsTable sst;</span><br><span class="line">        <span class="keyword">private</span> String lastContents;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> nextIsString;</span><br><span class="line">        <span class="keyword">private</span> String index = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">PagingHandler</span><span class="params">(SharedStringsTable sst)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.sst = sst;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 每个单元格开始时的处理</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startElement</span><span class="params">(String uri, String localName, String name, Attributes attributes)</span> <span class="keyword">throws</span> SAXException </span>&#123;</span><br><span class="line">            <span class="comment">// c =&gt; cell</span></span><br><span class="line">            <span class="keyword">if</span> (name.equals(<span class="string">&quot;c&quot;</span>)) &#123;</span><br><span class="line">                <span class="comment">// Print the cell reference</span></span><br><span class="line">                <span class="comment">// System.out.print(attributes.getValue(&quot;r&quot;) + &quot; - &quot;);</span></span><br><span class="line"></span><br><span class="line">                index = attributes.getValue(<span class="string">&quot;r&quot;</span>);</span><br><span class="line">                System.out.println(index);</span><br><span class="line">                <span class="keyword">if</span> (index.contains(<span class="string">&quot;N&quot;</span>)) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;##&quot;</span> + attributes + <span class="string">&quot;##&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 这是一个新行</span></span><br><span class="line">                <span class="keyword">if</span> (Pattern.compile(<span class="string">&quot;^&quot;</span> + indexC4Data + <span class="string">&quot;[0-9]+$&quot;</span>).matcher(index).find()) &#123;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 存储上一行数据</span></span><br><span class="line">                    <span class="keyword">if</span> (rowData != <span class="keyword">null</span> &amp;&amp; isAccess() &amp;&amp; !rowData.isEmpty()) &#123;</span><br><span class="line">                        dataList.add(rowData);</span><br><span class="line">                    &#125;</span><br><span class="line">                    rowData = <span class="keyword">new</span> ArrayList&lt;IndexValue&gt;();</span><br><span class="line">                    <span class="comment">// 新行要先清除上一行的数据</span></span><br><span class="line">                    currentRow++;<span class="comment">// 当前行+1</span></span><br><span class="line">                    <span class="comment">// System.out.println(currentRow);</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (isAccess()) &#123;</span><br><span class="line">                    <span class="comment">// Figure out if the value is an index in the SST</span></span><br><span class="line">                    String cellType = attributes.getValue(<span class="string">&quot;t&quot;</span>);</span><br><span class="line">                    <span class="keyword">if</span> (cellType != <span class="keyword">null</span> &amp;&amp; cellType.equals(<span class="string">&quot;s&quot;</span>)) &#123;</span><br><span class="line">                        nextIsString = <span class="keyword">true</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        nextIsString = <span class="keyword">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// Clear contents cache</span></span><br><span class="line">            lastContents = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 每个单元格结束时的处理</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">endElement</span><span class="params">(String uri, String localName, String name)</span> <span class="keyword">throws</span> SAXException </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (isAccess()) &#123;</span><br><span class="line">                <span class="comment">// Process the last contents as required.</span></span><br><span class="line">                <span class="comment">// Do now, as characters() may be called more than once</span></span><br><span class="line">                <span class="keyword">if</span> (nextIsString) &#123;</span><br><span class="line">                    <span class="keyword">int</span> idx = Integer.parseInt(lastContents);</span><br><span class="line">                    lastContents = <span class="keyword">new</span> XSSFRichTextString(sst.getEntryAt(idx)).toString();</span><br><span class="line">                    nextIsString = <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// v =&gt; contents of a cell</span></span><br><span class="line">                <span class="comment">// Output after we&#x27;ve seen the string contents</span></span><br><span class="line">                <span class="keyword">if</span> (name.equals(<span class="string">&quot;v&quot;</span>)) &#123;</span><br><span class="line">                    System.out.println(lastContents);</span><br><span class="line"></span><br><span class="line">                    rowData.add(<span class="keyword">new</span> IndexValue(index, lastContents));</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 目前流的方式值支持  Excel单元格是文本  格式；日期、数字、公式不支持</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">characters</span><span class="params">(<span class="keyword">char</span>[] ch, <span class="keyword">int</span> start, <span class="keyword">int</span> length)</span> <span class="keyword">throws</span> SAXException </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (isAccess()) &#123;</span><br><span class="line">                lastContents += <span class="keyword">new</span> String(ch, start, length);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 如果文档结束后，发现读取的末尾行正处在当前行中，存储下这行</span></span><br><span class="line"><span class="comment">         * （存在这样一种情况，当待读取的末尾行正好是文档最后一行时，最后一行无法存到集合中，</span></span><br><span class="line"><span class="comment">         * 因为最后一行没有下一行了，所以不为启动starElement()方法， 当然我们可以通过指定最大列来处理，但不想那么做，扩展性不好）</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">endDocument</span><span class="params">()</span> <span class="keyword">throws</span> SAXException </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (rowData != <span class="keyword">null</span> &amp;&amp; isAccess() &amp;&amp; !rowData.isEmpty()) &#123;</span><br><span class="line">                dataList.add(rowData);</span><br><span class="line">                System.out.println(<span class="string">&quot;--end&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isAccess</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (currentRow &gt;= startRow &amp;&amp; currentRow &lt;= endRow) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">IndexValue</span> </span>&#123;</span><br><span class="line">        String v_index;</span><br><span class="line">        String v_value;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">IndexValue</span><span class="params">(String v_index, String v_value)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>();</span><br><span class="line">            <span class="keyword">this</span>.v_index = v_index;</span><br><span class="line">            <span class="keyword">this</span>.v_value = v_value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;IndexValue [v_index=&quot;</span> + v_index + <span class="string">&quot;, v_value=&quot;</span> + v_value + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 去掉数字部分（行信息），直接比较英文部分（列信息），计算前后两个值相距多少空列</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> p</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getLevel</span><span class="params">(IndexValue p)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">/*char[] other = p.v_index.replaceAll(&quot;[0-9]&quot;, &quot;&quot;).toCharArray();</span></span><br><span class="line"><span class="comment">			char[] self = this.v_index.replaceAll(&quot;[0-9]&quot;, &quot;&quot;).toCharArray();</span></span><br><span class="line"><span class="comment">			if (other.length != self.length)</span></span><br><span class="line"><span class="comment">				return -1;</span></span><br><span class="line"><span class="comment">			for (int i = 0; i &lt; other.length; i++) &#123;</span></span><br><span class="line"><span class="comment">				if (i == other.length - 1) &#123;</span></span><br><span class="line"><span class="comment">					return self[i] - other[i];</span></span><br><span class="line"><span class="comment">				&#125; else &#123;</span></span><br><span class="line"><span class="comment">					if (self[i] != other[i]) &#123;</span></span><br><span class="line"><span class="comment">						return -1;</span></span><br><span class="line"><span class="comment">					&#125;</span></span><br><span class="line"><span class="comment">				&#125;</span></span><br><span class="line"><span class="comment">			&#125;</span></span><br><span class="line"><span class="comment">			return -1;*/</span></span><br><span class="line"></span><br><span class="line">            String other = p.v_index.replaceAll(<span class="string">&quot;[0-9]&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">            String self = <span class="keyword">this</span>.v_index.replaceAll(<span class="string">&quot;[0-9]&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> MathUtil.fromNumberSystem26(self) - MathUtil.fromNumberSystem26(other);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取真实的数据（处理空格，空行）</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;T&gt; <span class="title">getMyDataList</span><span class="params">(ExcelResultHandler&lt;T&gt; handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 1.首先需要 xlsx 的excel文件的header有几个字段，建议还是手动传进来，防止一些没有header的文件，以及</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> MAX_LIE = <span class="number">0</span>;</span><br><span class="line">        List&lt;T&gt; myDataList = <span class="keyword">new</span> ArrayList&lt;T&gt;();</span><br><span class="line">        <span class="keyword">if</span> (dataList == <span class="keyword">null</span> || dataList.size() &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> myDataList;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 是否是最后一行的数据</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">boolean</span> islastRow = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; dataList.size(); i++) &#123;</span><br><span class="line">            List&lt;IndexValue&gt; i_list = dataList.get(i);</span><br><span class="line">            List&lt;String&gt; row = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">            TmCase tmCase = <span class="keyword">new</span> TmCase();</span><br><span class="line">            <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (; j &lt; i_list.size() - <span class="number">1</span>; j++) &#123;</span><br><span class="line"><span class="comment">//            for (; j &lt; 10 - 1; j++) &#123;</span></span><br><span class="line">                <span class="comment">// 获取当前值,并存储</span></span><br><span class="line">                IndexValue current = i_list.get(j);</span><br><span class="line">                <span class="comment">//去掉空格</span></span><br><span class="line">                String tempV = current.v_value != <span class="keyword">null</span> ? current.v_value.trim() : current.v_value;</span><br><span class="line">                row.add(tempV);</span><br><span class="line">                <span class="comment">// 预存下一个</span></span><br><span class="line">                IndexValue next = i_list.get(j + <span class="number">1</span>);</span><br><span class="line">                <span class="comment">// 获取差值</span></span><br><span class="line">                <span class="keyword">int</span> level = next.getLevel(current);</span><br><span class="line">                System.out.println(<span class="string">&quot;level:==&gt;&quot;</span> + level);</span><br><span class="line">				<span class="comment">/*if(i==2214)&#123;</span></span><br><span class="line"><span class="comment">					System.out.println(&quot;--&quot;+i);</span></span><br><span class="line"><span class="comment">				&#125;*/</span></span><br><span class="line">                <span class="keyword">if</span> (level &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    System.err.println(<span class="string">&quot;---!!!到达最后一行，行号：&quot;</span> + (i + <span class="number">1</span>) + <span class="string">&quot;;level:&quot;</span> + level + <span class="string">&quot;[超出处理范围]&quot;</span>);</span><br><span class="line">                    islastRow = <span class="keyword">true</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//将差值补充为null，</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; level - <span class="number">1</span>; k++) &#123;</span><br><span class="line">                    <span class="comment">// 空值处理</span></span><br><span class="line">                    row.add(<span class="string">&quot;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">             * 每行的最后一个值，留在最后插入</span></span><br><span class="line"><span class="comment">             * 但最后一行除外</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">if</span> (!islastRow) &#123;</span><br><span class="line">                row.add(i_list.get(j).v_value);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 如果row.size不等于 列数，比如总共9列，可说第5列之后就没有 数据了，那么 i_list.size=5,需要额外补充4个</span></span><br><span class="line">            <span class="keyword">if</span> (row.size() &lt; <span class="keyword">this</span>.columnSize) &#123;</span><br><span class="line">                <span class="keyword">int</span> remain = <span class="keyword">this</span>.columnSize - row.size();</span><br><span class="line">                System.out.println(<span class="string">&quot;还差===》&quot;</span> + remain);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; remain; k++) &#123;</span><br><span class="line">                    row.add(<span class="string">&quot;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            T item = handler.handler(row);</span><br><span class="line">            myDataList.add(item);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> myDataList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        File file = <span class="keyword">new</span> File(<span class="string">&quot;/home/yinshi/Documents/CodeSource/test-write09.xlsx&quot;</span>);</span><br><span class="line"><span class="comment">//        MyExcel2007ForPaging_high myExcel2007ForPaging_high = new MyExcel2007ForPaging_high();</span></span><br><span class="line"><span class="comment">//        myExcel2007ForPaging_high.processFirstSheet(file.getPath(), 2, 50001);</span></span><br><span class="line">        List&lt;TmCase&gt; myDataList = <span class="keyword">new</span> MyExcel2007ForPaging_high_baK_bak(file.getPath(), <span class="number">10</span>, <span class="number">2</span>, <span class="number">50001</span>).</span><br><span class="line">                getMyDataList(<span class="keyword">new</span> TmCaseExcelResultHandler());</span><br><span class="line">        <span class="keyword">for</span> (TmCase tmCase : myDataList) &#123;</span><br><span class="line">            System.out.println(tmCase.toString());</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        System.out.println(myDataList);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="数据行转对象Handler"><a href="#数据行转对象Handler" class="headerlink" title="数据行转对象Handler"></a>数据行转对象Handler</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yinshi.gitstats.poi.sax;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ExcelResultHandler</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">T <span class="title">handler</span><span class="params">(List&lt;String&gt; sourceList)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="keyword">package</span> com.yinshi.gitstats.poi.sax;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yinshi.gitstats.entity.TmCase;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TmCaseExcelResultHandler</span> <span class="keyword">implements</span> <span class="title">ExcelResultHandler</span>&lt;<span class="title">TmCase</span>&gt;</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TmCase <span class="title">handler</span><span class="params">(List&lt;String&gt; sourceList)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> transList2TmCase(sourceList);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> TmCase <span class="title">transList2TmCase</span><span class="params">(List&lt;String&gt; sourceData)</span> </span>&#123;</span><br><span class="line">        System.out.println(sourceData.toString());</span><br><span class="line">        TmCase tmCase = <span class="keyword">new</span> TmCase();</span><br><span class="line">        tmCase.setLoanNo(sourceData.get(<span class="number">0</span>));</span><br><span class="line">        tmCase.setColDateStr(sourceData.get(<span class="number">1</span>));</span><br><span class="line">        tmCase.setColType(sourceData.get(<span class="number">2</span>));</span><br><span class="line">        tmCase.setColPerson(sourceData.get(<span class="number">3</span>));</span><br><span class="line">        tmCase.setColAddress(sourceData.get(<span class="number">4</span>));</span><br><span class="line">        tmCase.setColStatus(sourceData.get(<span class="number">5</span>));</span><br><span class="line">        tmCase.setConcreteColContent(sourceData.get(<span class="number">6</span>));</span><br><span class="line">        tmCase.setRepayDateStr(sourceData.get(<span class="number">7</span>));</span><br><span class="line">        tmCase.setRepayAmtStr(sourceData.get(<span class="number">8</span>));</span><br><span class="line">        tmCase.setErrorMsg(sourceData.get(<span class="number">9</span>));</span><br><span class="line">        <span class="keyword">return</span> tmCase;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String remark=<span class="string">&quot;我叫音十黎明&quot;</span>;</span><br><span class="line">        System.out.println(remark.length());</span><br><span class="line">        System.out.println(remark.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="辅助类"><a href="#辅助类" class="headerlink" title="辅助类"></a>辅助类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yinshi.gitstats.poi.sax;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MathUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * /// &lt;summary&gt;</span></span><br><span class="line"><span class="comment">     * /// 将指定的自然数转换为26进制表示。映射关系：[1-26] -&gt;[A-Z]。</span></span><br><span class="line"><span class="comment">     * /// &lt;/summary&gt;</span></span><br><span class="line"><span class="comment">     * /// &lt;param name=&quot;n&quot;&gt;自然数（如果无效，则返回空字符串）。&lt;/param&gt;</span></span><br><span class="line"><span class="comment">     * /// &lt;returns&gt;26进制表示。&lt;/returns&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">toNumberSystem26</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        String s = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">while</span> (n &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> m = n % <span class="number">26</span>;</span><br><span class="line">            <span class="keyword">if</span> (m == <span class="number">0</span>) &#123;</span><br><span class="line">                m = <span class="number">26</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            s = (<span class="keyword">char</span>) (m + <span class="number">64</span>) + s;</span><br><span class="line">            n = (n - m) / <span class="number">26</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;summary&gt;</span></span><br><span class="line"><span class="comment">     * 将指定的26进制表示转换为自然数。映射关系：[A-Z] -&gt;[1-26]。</span></span><br><span class="line"><span class="comment">     * &lt;/summary&gt;</span></span><br><span class="line"><span class="comment">     * &lt;param name=&quot;s&quot;&gt;26进制表示（如果无效，则返回0）。&lt;/param&gt;</span></span><br><span class="line"><span class="comment">     * &lt;returns&gt;自然数。&lt;/returns&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">fromNumberSystem26</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(s)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        s = s.toUpperCase();</span><br><span class="line">        <span class="keyword">int</span> n = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">char</span>[] arr = s.toCharArray();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = arr.length - <span class="number">1</span>, j = <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--, j *= <span class="number">26</span>) &#123;</span><br><span class="line">            <span class="keyword">char</span> c = arr[i];</span><br><span class="line">            <span class="keyword">if</span> (c &lt; <span class="string">&#x27;A&#x27;</span> || c &gt; <span class="string">&#x27;Z&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//A的ASCII值为65</span></span><br><span class="line">            n += ((<span class="keyword">int</span>) c - <span class="number">64</span>) * j;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(fromNumberSystem26(<span class="string">&quot;aa&quot;</span>));</span><br><span class="line">        System.out.println(toNumberSystem26(<span class="number">27</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="对外提供服务类"><a href="#对外提供服务类" class="headerlink" title="对外提供服务类"></a>对外提供服务类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yinshi.gitstats.poi.sax;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yinshi.gitstats.entity.TmCase;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReaderSaxPOIUtils</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"><span class="comment">//    private static ReaderSaxPOIUtils instance = null;</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 头文件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> TITLELINE_ROW_INDEX = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> ExcelResultHandler&lt;T&gt; excelResultHandler;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ReaderSaxPOIUtils</span><span class="params">(ExcelResultHandler&lt;T&gt; excelResultHandler)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.excelResultHandler = excelResultHandler;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    public static ReaderSaxPOIUtils getInstance() &#123;</span></span><br><span class="line"><span class="comment">//        if (instance == null) &#123;</span></span><br><span class="line"><span class="comment">//            instance = new ReaderSaxPOIUtils();</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"><span class="comment">//        return instance;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取文件标题</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 一般 文件的header就是第一行，所以</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file            源文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sumOfHeaderRows 代表标题header 占用几行，通常情况下 header就是第一行，sunofRow设置为 1 就可以</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="comment">//    public List&lt;List&lt;String&gt;&gt; getTitles(File file, int sumOfHeaderRows) throws Exception &#123;</span></span><br><span class="line"><span class="comment">//    public List&lt;List&lt;String&gt;&gt; getTitles(File file, int sumOfHeaderRows) throws Exception &#123;</span></span><br><span class="line"><span class="comment">//        //由于这里标题就是具体内容，所以应该把标题当做要获取的数据</span></span><br><span class="line"><span class="comment">//        return this.getPagingData(file, 1, sumOfHeaderRows, sumOfHeaderRows, 0);</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 利用POI的sax方式分页读取2007的Excel</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pageIndex      页号 从1开始</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pagesizeRows   页内行数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> totalCountRows 实际的总行数（去除标题）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outOfTitleRow  忽略标题行的行数，负数忽略，0代表包含标题，正值代表跳过的标题数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;T&gt; <span class="title">getPagingData</span><span class="params">(File file, <span class="keyword">int</span> pageIndex,</span></span></span><br><span class="line"><span class="function"><span class="params">                                            <span class="keyword">int</span> pagesizeRows, <span class="keyword">int</span> totalCountRows, <span class="keyword">int</span> outOfTitleRow)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 总记录行数（除去标题）</span></span><br><span class="line">        <span class="keyword">int</span> sumOfRows = totalCountRows;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// SAX解析方式第一行是1，不是0</span></span><br><span class="line">        <span class="keyword">int</span> headLineRowNum = <span class="keyword">this</span>.TITLELINE_ROW_INDEX;</span><br><span class="line">        <span class="keyword">if</span> (outOfTitleRow &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            headLineRowNum += outOfTitleRow;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 循环的默认起始和结束</span></span><br><span class="line">        <span class="keyword">int</span> startRow = headLineRowNum + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> endRow = startRow + pagesizeRows - <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// 最后一行的行号</span></span><br><span class="line">        <span class="keyword">int</span> lastRowNum = sumOfRows + headLineRowNum;</span><br><span class="line">        <span class="keyword">int</span> odd = sumOfRows - ((pageIndex - <span class="number">1</span>) * pagesizeRows);<span class="comment">// 本页之前的所有记录</span></span><br><span class="line">        <span class="keyword">if</span> ((pageIndex - <span class="number">1</span>) * pagesizeRows &gt;= sumOfRows) &#123;<span class="comment">// 本页之前的所有记录已经超过总数了</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> LinkedList&lt;T&gt;();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (odd &gt; <span class="number">0</span> &amp;&amp; odd &lt;= pagesizeRows) &#123;<span class="comment">// 剩下的行数不够本页显示数</span></span><br><span class="line"></span><br><span class="line">            startRow = (headLineRowNum + <span class="number">1</span>) + (pageIndex - <span class="number">1</span>) * pagesizeRows;</span><br><span class="line">            endRow = lastRowNum;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;<span class="comment">// 所剩行数充足</span></span><br><span class="line">            startRow = headLineRowNum + (pageIndex - <span class="number">1</span>) * pagesizeRows + <span class="number">1</span>;</span><br><span class="line">            endRow = headLineRowNum + pageIndex * pagesizeRows;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyExcel2007ForPaging_high(file.getPath(), <span class="number">10</span>, startRow, endRow).getMyDataList(excelResultHandler);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 采用SAX读取2007版的xlsx形式的Excel的最大行</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> f</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getSize4TheFile</span><span class="params">(File f)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        MyExcel2007ForMaxRow reader = <span class="keyword">new</span> MyExcel2007ForMaxRow(f.getPath());</span><br><span class="line">        <span class="keyword">return</span> reader.maxRow - (<span class="keyword">this</span>.TITLELINE_ROW_INDEX + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        File file = <span class="keyword">new</span> File(<span class="string">&quot;/home/yinshi/Documents/CodeSource/test-write08.xlsx&quot;</span>);</span><br><span class="line">        System.out.println(file.getPath());</span><br><span class="line">        System.out.println(file.getName());</span><br><span class="line"><span class="comment">//        TmCaseExcelResultHandler excelResultHandler = new TmCaseExcelResultHandler();</span></span><br><span class="line"><span class="comment">//        ReaderSaxPOIUtils&lt;TmCase&gt; saxPOIUtils = new ReaderSaxPOIUtils&lt;&gt;(excelResultHandler);</span></span><br><span class="line"><span class="comment">//        long size4TheFile = saxPOIUtils.getSize4TheFile(file);</span></span><br><span class="line"><span class="comment">//        System.out.println(size4TheFile);</span></span><br><span class="line"><span class="comment">////        List&lt;List&lt;String&gt;&gt; titles = saxPOIUtils.getTitles(file, 2);</span></span><br><span class="line"><span class="comment">////        System.out.println(&quot;===&gt;&quot; + titles);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        List&lt;TmCase&gt; pagingData = saxPOIUtils.getPagingData(file, 1, 10, (int) size4TheFile, 1);</span></span><br><span class="line"><span class="comment">//        System.out.println(pagingData);</span></span><br><span class="line"><span class="comment">//        System.out.println(&quot;======&gt;&quot; + pagingData.size());</span></span><br><span class="line">        String fileNma=<span class="string">&quot;222.xlsx&quot;</span>;</span><br><span class="line">        String replace = fileNma.replace(<span class="string">&quot;.xlsx&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        System.out.println(replace);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h4><ol>
<li>getDataList本来 返回的是一个 List&lt;List<String>&gt;类型的结果集，因为一个单元格Cell解析出来的就是一个string字符串，所以一行rowData 代表的是List<String>，那一页sheet 代表的就是 List&lt;List<String>&gt; ,</li>
<li>我本来想使用策略模式，类似与JDBC的ResultHandler 一样，自行处理得到的结果集 ，就是 ExcelResultHandler 做的事情，将得到的rowData 转换为一个 泛型类， 但是感觉这样又有一个弊端， 就是处理 头文件 headerTitle 的数据的时候有些问题，因为头文件本身就不是一个 对象，它就应该是一个 List<String> 的 集合，所以我把  getTitle 方法获取 headerTitle的方法 给注释了 ，总之 这一块需要特殊处理</li>
<li> 再说一下使用方式 ，我们已经获取到了 文件的总行数totaCount ，我们就可以 进行分页了，就像 mybatis分页一样，我们可以自定义pageSize 一页有多少数据，然后使用pageCount= totalCount / pageSize，去计算页数，再在自己的 业务入口类中去 for（int pageIndex=1; pageIndex++;pageIndex&lt;=pageSize）循环获取分页数据进行处理 </li>
<li>最后说一下， 插入数据库 的方法建议自己重写一下，不要一条一条的insert， 太慢了，自己定义一个commitCount，比如2000条提交一次 </li>
</ol>
<h3 id="方案2：流式处理"><a href="#方案2：流式处理" class="headerlink" title="方案2：流式处理"></a>方案2：流式处理</h3><table>
<thead>
<tr>
<th>origin</th>
<th><a target="_blank" rel="noopener" href="https://github.com/monitorjbl/excel-streaming-reader.git">https://github.com/monitorjbl/excel-streaming-reader.git</a></th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="依赖包-1"><a href="#依赖包-1" class="headerlink" title="依赖包"></a>依赖包</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!-- https://mvnrepository.com/artifact/com.monitorjbl/xlsx-streamer --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.monitorjbl&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;xlsx-streamer&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.1.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;joda-time&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;joda-time&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.9.8&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- apache poi 操作Microsoft Document --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;poi&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.17&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- Apache POI - Java API To Access Microsoft Format Files--&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;poi-ooxml&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.17&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- Apache POI - Java API To Access Microsoft Format Files--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;poi-ooxml-schemas&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.17&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- poi eventmodel方式 依赖包 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;xerces&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;xercesImpl&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.11.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>



<h4 id="使用方式："><a href="#使用方式：" class="headerlink" title="使用方式："></a>使用方式：</h4><p>我们可以下载 这个项目的源代码看看,看里面的测试类，也可以大概知道使用方式 StreamingReaderTest</p>
<p>src/test/java/com/monitorjbl/xlsx/StreamingReaderTest.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.monitorjbl.xlsx;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.monitorjbl.xlsx.exceptions.MissingSheetException;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.openxml4j.opc.OPCPackage;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.openxml4j.opc.PackageAccess;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.Cell;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.CellType;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.DateUtil;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.Row;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.Sheet;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.Workbook;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.BeforeAll;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Calendar;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.GregorianCalendar;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Locale;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Spliterator;</span><br><span class="line"><span class="keyword">import</span> java.util.Spliterators;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.StreamSupport;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.apache.poi.ss.usermodel.CellType.BOOLEAN;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.apache.poi.ss.usermodel.CellType.NUMERIC;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.apache.poi.ss.usermodel.CellType.STRING;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.apache.poi.ss.usermodel.Row.MissingCellPolicy.CREATE_NULL_AS_BLANK;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.apache.poi.ss.usermodel.Row.MissingCellPolicy.RETURN_BLANK_AS_NULL;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.CoreMatchers.equalTo;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.CoreMatchers.nullValue;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.MatcherAssert.assertThat;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.core.Is.is;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.assertEquals;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.assertFalse;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.assertNotNull;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.assertNull;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.assertThrows;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.assertTrue;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.fail;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StreamingReaderTest</span> </span>&#123;</span><br><span class="line">  <span class="meta">@BeforeAll</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Locale.setDefault(Locale.ENGLISH);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetDateCellValue</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">try</span>(</span><br><span class="line">        InputStream is = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;src/test/resources/data_types.xlsx&quot;</span>);</span><br><span class="line">        Workbook wb = StreamingReader.builder().open(is);</span><br><span class="line">    ) &#123;</span><br><span class="line"></span><br><span class="line">      List&lt;List&lt;Cell&gt;&gt; obj = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span>(Row r : wb.getSheetAt(<span class="number">0</span>)) &#123;</span><br><span class="line">        List&lt;Cell&gt; o = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(Cell c : r) &#123;</span><br><span class="line">          o.add(c);</span><br><span class="line">        &#125;</span><br><span class="line">        obj.add(o);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      Date dt = obj.get(<span class="number">4</span>).get(<span class="number">1</span>).getDateCellValue();</span><br><span class="line">      assertNotNull(dt);</span><br><span class="line">      <span class="keyword">final</span> GregorianCalendar cal = <span class="keyword">new</span> GregorianCalendar();</span><br><span class="line">      cal.setTime(dt);</span><br><span class="line">      assertEquals(cal.get(Calendar.YEAR), <span class="number">2014</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Verify LocalDateTime version is correct as well</span></span><br><span class="line">      LocalDateTime localDateTime = obj.get(<span class="number">4</span>).get(<span class="number">1</span>).getLocalDateTimeCellValue();</span><br><span class="line">      assertEquals(<span class="number">2014</span>, localDateTime.getYear());</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        obj.get(<span class="number">0</span>).get(<span class="number">0</span>).getDateCellValue();</span><br><span class="line">        fail(<span class="string">&quot;Should have thrown IllegalStateException&quot;</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span>(IllegalStateException e) &#123; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetDateCellValue1904</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">try</span>(</span><br><span class="line">        InputStream is = <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(<span class="string">&quot;src/test/resources/1904Dates.xlsx&quot;</span>));</span><br><span class="line">        Workbook wb = StreamingReader.builder().open(is);</span><br><span class="line">    ) &#123;</span><br><span class="line"></span><br><span class="line">      List&lt;List&lt;Cell&gt;&gt; obj = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span>(Row r : wb.getSheetAt(<span class="number">0</span>)) &#123;</span><br><span class="line">        List&lt;Cell&gt; o = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(Cell c : r) &#123;</span><br><span class="line">          o.add(c);</span><br><span class="line">        &#125;</span><br><span class="line">        obj.add(o);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      Date dt = obj.get(<span class="number">1</span>).get(<span class="number">5</span>).getDateCellValue();</span><br><span class="line">      assertNotNull(dt);</span><br><span class="line">      <span class="keyword">final</span> GregorianCalendar cal = <span class="keyword">new</span> GregorianCalendar();</span><br><span class="line">      cal.setTime(dt);</span><br><span class="line">      assertEquals(cal.get(Calendar.YEAR), <span class="number">1991</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        obj.get(<span class="number">0</span>).get(<span class="number">0</span>).getDateCellValue();</span><br><span class="line">        fail(<span class="string">&quot;Should have thrown IllegalStateException&quot;</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span>(IllegalStateException e) &#123; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetFirstCellNum</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">try</span>(</span><br><span class="line">        InputStream is = <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(<span class="string">&quot;src/test/resources/gaps.xlsx&quot;</span>));</span><br><span class="line">        Workbook wb = StreamingReader.builder().open(is);</span><br><span class="line">    ) &#123;</span><br><span class="line"></span><br><span class="line">      List&lt;List&lt;Cell&gt;&gt; obj = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">      List&lt;Row&gt; rows = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">      <span class="keyword">for</span>(Row r : wb.getSheetAt(<span class="number">0</span>)) &#123;</span><br><span class="line">        rows.add(r);</span><br><span class="line">        List&lt;Cell&gt; o = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(Cell c : r) &#123;</span><br><span class="line">          o.add(c);</span><br><span class="line">        &#125;</span><br><span class="line">        obj.add(o);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      assertEquals(<span class="number">3</span>, rows.size());</span><br><span class="line">      assertEquals(<span class="number">3</span>, rows.get(<span class="number">2</span>).getFirstCellNum());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGaps</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">try</span>(</span><br><span class="line">        InputStream is = <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(<span class="string">&quot;src/test/resources/gaps.xlsx&quot;</span>));</span><br><span class="line">        Workbook wb = StreamingReader.builder().open(is);</span><br><span class="line">    ) &#123;</span><br><span class="line">      List&lt;List&lt;Cell&gt;&gt; obj = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span>(Row r : wb.getSheetAt(<span class="number">0</span>)) &#123;</span><br><span class="line">        List&lt;Cell&gt; o = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(Cell c : r) &#123;</span><br><span class="line">          o.add(c);</span><br><span class="line">        &#125;</span><br><span class="line">        obj.add(o);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      assertEquals(<span class="number">3</span>, obj.size());</span><br><span class="line">      List&lt;Cell&gt; row;</span><br><span class="line"></span><br><span class="line">      row = obj.get(<span class="number">0</span>);</span><br><span class="line">      assertEquals(<span class="number">2</span>, row.size());</span><br><span class="line">      assertEquals(STRING, row.get(<span class="number">0</span>).getCellType());</span><br><span class="line">      assertEquals(STRING, row.get(<span class="number">1</span>).getCellType());</span><br><span class="line">      assertEquals(<span class="string">&quot;Dat&quot;</span>, row.get(<span class="number">0</span>).getStringCellValue());</span><br><span class="line">      assertEquals(<span class="string">&quot;Dat&quot;</span>, row.get(<span class="number">0</span>).getRichStringCellValue().getString());</span><br><span class="line">      assertEquals(<span class="number">0</span>, row.get(<span class="number">0</span>).getColumnIndex());</span><br><span class="line">      assertEquals(<span class="number">0</span>, row.get(<span class="number">0</span>).getRowIndex());</span><br><span class="line">      assertEquals(<span class="string">&quot;gap&quot;</span>, row.get(<span class="number">1</span>).getStringCellValue());</span><br><span class="line">      assertEquals(<span class="string">&quot;gap&quot;</span>, row.get(<span class="number">1</span>).getRichStringCellValue().getString());</span><br><span class="line">      assertEquals(<span class="number">2</span>, row.get(<span class="number">1</span>).getColumnIndex());</span><br><span class="line">      assertEquals(<span class="number">0</span>, row.get(<span class="number">1</span>).getRowIndex());</span><br><span class="line"></span><br><span class="line">      row = obj.get(<span class="number">1</span>);</span><br><span class="line">      assertEquals(<span class="number">2</span>, row.size());</span><br><span class="line">      assertEquals(STRING, row.get(<span class="number">0</span>).getCellType());</span><br><span class="line">      assertEquals(STRING, row.get(<span class="number">1</span>).getCellType());</span><br><span class="line">      assertEquals(<span class="string">&quot;guuurrrrrl&quot;</span>, row.get(<span class="number">0</span>).getStringCellValue());</span><br><span class="line">      assertEquals(<span class="string">&quot;guuurrrrrl&quot;</span>, row.get(<span class="number">0</span>).getRichStringCellValue().getString());</span><br><span class="line">      assertEquals(<span class="number">0</span>, row.get(<span class="number">0</span>).getColumnIndex());</span><br><span class="line">      assertEquals(<span class="number">6</span>, row.get(<span class="number">0</span>).getRowIndex());</span><br><span class="line">      assertEquals(<span class="string">&quot;!&quot;</span>, row.get(<span class="number">1</span>).getStringCellValue());</span><br><span class="line">      assertEquals(<span class="string">&quot;!&quot;</span>, row.get(<span class="number">1</span>).getRichStringCellValue().getString());</span><br><span class="line">      assertEquals(<span class="number">6</span>, row.get(<span class="number">1</span>).getColumnIndex());</span><br><span class="line">      assertEquals(<span class="number">6</span>, row.get(<span class="number">1</span>).getRowIndex());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMultipleSheets_alpha</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">try</span>(</span><br><span class="line">        InputStream is = <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(<span class="string">&quot;src/test/resources/sheets.xlsx&quot;</span>));</span><br><span class="line">        Workbook wb = StreamingReader.builder().open(is);</span><br><span class="line">    ) &#123;</span><br><span class="line">      List&lt;List&lt;Cell&gt;&gt; obj = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span>(Row r : wb.getSheetAt(<span class="number">0</span>)) &#123;</span><br><span class="line">        List&lt;Cell&gt; o = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(Cell c : r) &#123;</span><br><span class="line">          o.add(c);</span><br><span class="line">        &#125;</span><br><span class="line">        obj.add(o);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      assertEquals(<span class="number">1</span>, obj.size());</span><br><span class="line">      List&lt;Cell&gt; row;</span><br><span class="line"></span><br><span class="line">      row = obj.get(<span class="number">0</span>);</span><br><span class="line">      assertEquals(<span class="number">1</span>, row.size());</span><br><span class="line">      assertEquals(<span class="string">&quot;stuff&quot;</span>, row.get(<span class="number">0</span>).getStringCellValue());</span><br><span class="line">      assertEquals(<span class="string">&quot;stuff&quot;</span>, row.get(<span class="number">0</span>).getRichStringCellValue().getString());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMultipleSheets_zulu</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">try</span>(</span><br><span class="line">        InputStream is = <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(<span class="string">&quot;src/test/resources/sheets.xlsx&quot;</span>));</span><br><span class="line">        Workbook wb = StreamingReader.builder().open(is);</span><br><span class="line">    ) &#123;</span><br><span class="line"></span><br><span class="line">      List&lt;List&lt;Cell&gt;&gt; obj = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span>(Row r : wb.getSheetAt(<span class="number">1</span>)) &#123;</span><br><span class="line">        List&lt;Cell&gt; o = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(Cell c : r) &#123;</span><br><span class="line">          o.add(c);</span><br><span class="line">        &#125;</span><br><span class="line">        obj.add(o);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      assertEquals(<span class="number">1</span>, obj.size());</span><br><span class="line">      List&lt;Cell&gt; row;</span><br><span class="line"></span><br><span class="line">      row = obj.get(<span class="number">0</span>);</span><br><span class="line">      assertEquals(<span class="number">1</span>, row.size());</span><br><span class="line">      assertEquals(<span class="string">&quot;yeah&quot;</span>, row.get(<span class="number">0</span>).getStringCellValue());</span><br><span class="line">      assertEquals(<span class="string">&quot;yeah&quot;</span>, row.get(<span class="number">0</span>).getRichStringCellValue().getString());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSheetName_zulu</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">try</span>(</span><br><span class="line">        InputStream is = <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(<span class="string">&quot;src/test/resources/sheets.xlsx&quot;</span>));</span><br><span class="line">        Workbook wb = StreamingReader.builder().open(is);</span><br><span class="line">    ) &#123;</span><br><span class="line"></span><br><span class="line">      List&lt;List&lt;Cell&gt;&gt; obj = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span>(Row r : wb.getSheet(<span class="string">&quot;SheetZulu&quot;</span>)) &#123;</span><br><span class="line">        List&lt;Cell&gt; o = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(Cell c : r) &#123;</span><br><span class="line">          o.add(c);</span><br><span class="line">        &#125;</span><br><span class="line">        obj.add(o);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      assertEquals(<span class="number">1</span>, obj.size());</span><br><span class="line">      List&lt;Cell&gt; row;</span><br><span class="line"></span><br><span class="line">      row = obj.get(<span class="number">0</span>);</span><br><span class="line">      assertEquals(<span class="number">1</span>, row.size());</span><br><span class="line">      assertEquals(<span class="string">&quot;yeah&quot;</span>, row.get(<span class="number">0</span>).getStringCellValue());</span><br><span class="line">      assertEquals(<span class="string">&quot;yeah&quot;</span>, row.get(<span class="number">0</span>).getRichStringCellValue().getString());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSheetName_alpha</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">try</span>(</span><br><span class="line">        InputStream is = <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(<span class="string">&quot;src/test/resources/sheets.xlsx&quot;</span>));</span><br><span class="line">        Workbook wb = StreamingReader.builder().open(is);</span><br><span class="line">    ) &#123;</span><br><span class="line">      List&lt;List&lt;Cell&gt;&gt; obj = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span>(Row r : wb.getSheet(<span class="string">&quot;SheetAlpha&quot;</span>)) &#123;</span><br><span class="line">        List&lt;Cell&gt; o = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(Cell c : r) &#123;</span><br><span class="line">          o.add(c);</span><br><span class="line">        &#125;</span><br><span class="line">        obj.add(o);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      assertEquals(<span class="number">1</span>, obj.size());</span><br><span class="line">      List&lt;Cell&gt; row;</span><br><span class="line"></span><br><span class="line">      row = obj.get(<span class="number">0</span>);</span><br><span class="line">      assertEquals(<span class="number">1</span>, row.size());</span><br><span class="line">      assertEquals(<span class="string">&quot;stuff&quot;</span>, row.get(<span class="number">0</span>).getStringCellValue());</span><br><span class="line">      assertEquals(<span class="string">&quot;stuff&quot;</span>, row.get(<span class="number">0</span>).getRichStringCellValue().getString());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSheetName_missingInStream</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">try</span>(</span><br><span class="line">        InputStream is = <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(<span class="string">&quot;src/test/resources/sheets.xlsx&quot;</span>));</span><br><span class="line">        Workbook wb = StreamingReader.builder().open(is);</span><br><span class="line">    ) &#123;</span><br><span class="line">      assertThrows(MissingSheetException.class, ()-&gt;wb.getSheet(<span class="string">&quot;asdfasdfasdf&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSheetName_missingInFile</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    File f = <span class="keyword">new</span> File(<span class="string">&quot;src/test/resources/sheets.xlsx&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span>(Workbook wb = StreamingReader.builder().open(f)) &#123;</span><br><span class="line">      wb.getSheet(<span class="string">&quot;asdfasdfasdf&quot;</span>);</span><br><span class="line">      fail(<span class="string">&quot;Should have failed&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span>(MissingSheetException e) &#123;</span><br><span class="line">      assertTrue(f.exists());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testIteration</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    File f = <span class="keyword">new</span> File(<span class="string">&quot;src/test/resources/large.xlsx&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span>(</span><br><span class="line">        Workbook wb = StreamingReader.builder()</span><br><span class="line">            .rowCacheSize(<span class="number">5</span>)</span><br><span class="line">            .open(f)) &#123;</span><br><span class="line">      <span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">for</span>(Row r : wb.getSheetAt(<span class="number">0</span>)) &#123;</span><br><span class="line">        assertEquals(i, r.getCell(<span class="number">0</span>).getNumericCellValue(), <span class="number">0</span>);</span><br><span class="line">        assertEquals(<span class="string">&quot;#&quot;</span> + i, r.getCell(<span class="number">1</span>).getStringCellValue());</span><br><span class="line">        assertEquals(<span class="string">&quot;#&quot;</span> + i, r.getCell(<span class="number">1</span>).getRichStringCellValue().getString());</span><br><span class="line">        i++;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLeadingZeroes</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    File f = <span class="keyword">new</span> File(<span class="string">&quot;src/test/resources/leadingZeroes.xlsx&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>(Workbook wb = StreamingReader.builder().open(f)) &#123;</span><br><span class="line">      Iterator&lt;Row&gt; iter = wb.getSheetAt(<span class="number">0</span>).iterator();</span><br><span class="line">      iter.hasNext();</span><br><span class="line"></span><br><span class="line">      Row r1 = iter.next();</span><br><span class="line">      assertEquals(<span class="number">1</span>, r1.getCell(<span class="number">0</span>).getNumericCellValue(), <span class="number">0</span>);</span><br><span class="line">      assertEquals(<span class="string">&quot;1&quot;</span>, r1.getCell(<span class="number">0</span>).getStringCellValue());</span><br><span class="line">      assertEquals(NUMERIC, r1.getCell(<span class="number">0</span>).getCellType());</span><br><span class="line"></span><br><span class="line">      Row r2 = iter.next();</span><br><span class="line">      assertEquals(<span class="number">2</span>, r2.getCell(<span class="number">0</span>).getNumericCellValue(), <span class="number">0</span>);</span><br><span class="line">      assertEquals(<span class="string">&quot;0002&quot;</span>, r2.getCell(<span class="number">0</span>).getStringCellValue());</span><br><span class="line">      assertEquals(<span class="string">&quot;0002&quot;</span>, r2.getCell(<span class="number">0</span>).getRichStringCellValue().getString());</span><br><span class="line">      assertEquals(STRING, r2.getCell(<span class="number">0</span>).getCellType());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testReadingEmptyFile</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    File f = <span class="keyword">new</span> File(<span class="string">&quot;src/test/resources/empty_sheet.xlsx&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>(Workbook wb = StreamingReader.builder().open(f)) &#123;</span><br><span class="line">      Iterator&lt;Row&gt; iter = wb.getSheetAt(<span class="number">0</span>).iterator();</span><br><span class="line">      assertThat(iter.hasNext(), is(<span class="keyword">false</span>));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSpecialStyles</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    File f = <span class="keyword">new</span> File(<span class="string">&quot;src/test/resources/special_types.xlsx&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Map&lt;Integer, List&lt;Cell&gt;&gt; contents = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">try</span>(Workbook wb = StreamingReader.builder().open(f)) &#123;</span><br><span class="line">      <span class="keyword">for</span>(Row row : wb.getSheetAt(<span class="number">0</span>)) &#123;</span><br><span class="line">        contents.put(row.getRowNum(), <span class="keyword">new</span> ArrayList&lt;Cell&gt;());</span><br><span class="line">        <span class="keyword">for</span>(Cell c : row) &#123;</span><br><span class="line">          <span class="keyword">if</span>(c.getColumnIndex() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            contents.get(row.getRowNum()).add(c);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    SimpleDateFormat df = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;dd/MM/yyyy&quot;</span>);</span><br><span class="line"></span><br><span class="line">    assertThat(contents.size(), equalTo(<span class="number">2</span>));</span><br><span class="line">    assertThat(contents.get(<span class="number">0</span>).size(), equalTo(<span class="number">4</span>));</span><br><span class="line">    assertThat(contents.get(<span class="number">0</span>).get(<span class="number">0</span>).getStringCellValue(), equalTo(<span class="string">&quot;Thu\&quot;, \&quot;Dec 25\&quot;, \&quot;14&quot;</span>));</span><br><span class="line">    assertThat(contents.get(<span class="number">0</span>).get(<span class="number">0</span>).getDateCellValue(), equalTo(df.parse(<span class="string">&quot;25/12/2014&quot;</span>)));</span><br><span class="line">    assertThat(contents.get(<span class="number">0</span>).get(<span class="number">1</span>).getStringCellValue(), equalTo(<span class="string">&quot;02/04/15&quot;</span>));</span><br><span class="line">    assertThat(contents.get(<span class="number">0</span>).get(<span class="number">1</span>).getDateCellValue(), equalTo(df.parse(<span class="string">&quot;04/02/2015&quot;</span>)));</span><br><span class="line">    assertThat(contents.get(<span class="number">0</span>).get(<span class="number">2</span>).getStringCellValue(), equalTo(<span class="string">&quot;14\&quot;. \&quot;Mar\&quot;. \&quot;2015&quot;</span>));</span><br><span class="line">    assertThat(contents.get(<span class="number">0</span>).get(<span class="number">2</span>).getDateCellValue(), equalTo(df.parse(<span class="string">&quot;14/03/2015&quot;</span>)));</span><br><span class="line">    assertThat(contents.get(<span class="number">0</span>).get(<span class="number">3</span>).getStringCellValue(), equalTo(<span class="string">&quot;2015-05-05&quot;</span>));</span><br><span class="line">    assertThat(contents.get(<span class="number">0</span>).get(<span class="number">3</span>).getDateCellValue(), equalTo(df.parse(<span class="string">&quot;05/05/2015&quot;</span>)));</span><br><span class="line"></span><br><span class="line">    assertThat(contents.get(<span class="number">1</span>).size(), equalTo(<span class="number">4</span>));</span><br><span class="line">    assertThat(contents.get(<span class="number">1</span>).get(<span class="number">0</span>).getStringCellValue(), equalTo(<span class="string">&quot;3.12&quot;</span>));</span><br><span class="line">    assertThat(contents.get(<span class="number">1</span>).get(<span class="number">0</span>).getNumericCellValue(), equalTo(<span class="number">3.12312312312</span>));</span><br><span class="line">    assertThat(contents.get(<span class="number">1</span>).get(<span class="number">1</span>).getStringCellValue(), equalTo(<span class="string">&quot;1,023,042&quot;</span>));</span><br><span class="line">    assertThat(contents.get(<span class="number">1</span>).get(<span class="number">1</span>).getNumericCellValue(), equalTo(<span class="number">1023042.0</span>));</span><br><span class="line">    assertThat(contents.get(<span class="number">1</span>).get(<span class="number">2</span>).getStringCellValue(), equalTo(<span class="string">&quot;-312,231.12&quot;</span>));</span><br><span class="line">    assertThat(contents.get(<span class="number">1</span>).get(<span class="number">2</span>).getNumericCellValue(), equalTo(-<span class="number">312231.12123145</span>));</span><br><span class="line">    assertThat(contents.get(<span class="number">1</span>).get(<span class="number">3</span>).getStringCellValue(), equalTo(<span class="string">&quot;(132)&quot;</span>));</span><br><span class="line">    assertThat(contents.get(<span class="number">1</span>).get(<span class="number">3</span>).getNumericCellValue(), equalTo(-<span class="number">132.0</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testBlankNumerics</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    File f = <span class="keyword">new</span> File(<span class="string">&quot;src/test/resources/blank_cells.xlsx&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span>(Workbook wb = StreamingReader.builder().open(f)) &#123;</span><br><span class="line">      Row row = wb.getSheetAt(<span class="number">0</span>).iterator().next();</span><br><span class="line">      assertThat(row.getCell(<span class="number">1</span>).getStringCellValue(), equalTo(<span class="string">&quot;&quot;</span>));</span><br><span class="line">      assertThat(row.getCell(<span class="number">1</span>).getRichStringCellValue().getString(), equalTo(<span class="string">&quot;&quot;</span>));</span><br><span class="line">      assertThat(row.getCell(<span class="number">1</span>).getDateCellValue(), is(nullValue()));</span><br><span class="line">      assertThat(row.getCell(<span class="number">1</span>).getNumericCellValue(), equalTo(<span class="number">0.0</span>));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFirstRowNumIs0</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    File f = <span class="keyword">new</span> File(<span class="string">&quot;src/test/resources/data_types.xlsx&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span>(Workbook wb = StreamingReader.builder().open(f)) &#123;</span><br><span class="line">      Row row = wb.getSheetAt(<span class="number">0</span>).iterator().next();</span><br><span class="line">      assertThat(row.getRowNum(), equalTo(<span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testNoTypeCell</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">try</span>(</span><br><span class="line">        InputStream is = <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(<span class="string">&quot;src/test/resources/no_type_cell.xlsx&quot;</span>));</span><br><span class="line">        Workbook wb = StreamingReader.builder().open(is)) &#123;</span><br><span class="line">      <span class="keyword">for</span>(Row r : wb.getSheetAt(<span class="number">0</span>)) &#123;</span><br><span class="line">        <span class="keyword">for</span>(Cell c : r) &#123;</span><br><span class="line">          assertEquals(<span class="string">&quot;1&quot;</span>, c.getStringCellValue());</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testEncryption</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">try</span>(</span><br><span class="line">        InputStream is = <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(<span class="string">&quot;src/test/resources/encrypted.xlsx&quot;</span>));</span><br><span class="line">        Workbook wb = StreamingReader.builder().password(<span class="string">&quot;test&quot;</span>).open(is)) &#123;</span><br><span class="line">      OUTER:</span><br><span class="line">      <span class="keyword">for</span>(Row r : wb.getSheetAt(<span class="number">0</span>)) &#123;</span><br><span class="line">        <span class="keyword">for</span>(Cell c : r) &#123;</span><br><span class="line">          assertEquals(<span class="string">&quot;Demo&quot;</span>, c.getStringCellValue());</span><br><span class="line">          assertEquals(<span class="string">&quot;Demo&quot;</span>, c.getRichStringCellValue().getString());</span><br><span class="line">          <span class="keyword">break</span> OUTER;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testStringCellValue</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">try</span>(</span><br><span class="line">        InputStream is = <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(<span class="string">&quot;src/test/resources/blank_cell_StringCellValue.xlsx&quot;</span>));</span><br><span class="line">        Workbook wb = StreamingReader.builder().open(is);</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">for</span>(Row r : wb.getSheetAt(<span class="number">0</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span>(r.getRowNum() == <span class="number">1</span>) &#123;</span><br><span class="line">          assertEquals(<span class="string">&quot;&quot;</span>, r.getCell(<span class="number">1</span>).getStringCellValue());</span><br><span class="line">          assertEquals(<span class="string">&quot;&quot;</span>, r.getCell(<span class="number">1</span>).getRichStringCellValue().getString());</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testNullValueType</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">try</span>(</span><br><span class="line">        InputStream is = <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(<span class="string">&quot;src/test/resources/null_celltype.xlsx&quot;</span>));</span><br><span class="line">        Workbook wb = StreamingReader.builder().open(is);</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">for</span>(Row r : wb.getSheetAt(<span class="number">0</span>)) &#123;</span><br><span class="line">        <span class="keyword">for</span>(Cell cell : r) &#123;</span><br><span class="line">          <span class="keyword">if</span>(r.getRowNum() == <span class="number">0</span> &amp;&amp; cell.getColumnIndex() == <span class="number">8</span>) &#123;</span><br><span class="line">            assertEquals(NUMERIC, cell.getCellType());</span><br><span class="line">            assertEquals(<span class="string">&quot;8:00:00&quot;</span>, cell.getStringCellValue());</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInlineCells</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">try</span>(</span><br><span class="line">        InputStream is = <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(<span class="string">&quot;src/test/resources/inline.xlsx&quot;</span>));</span><br><span class="line">        Workbook wb = StreamingReader.builder().open(is);</span><br><span class="line">    ) &#123;</span><br><span class="line">      Row row = wb.getSheetAt(<span class="number">0</span>).iterator().next();</span><br><span class="line">      assertEquals(<span class="string">&quot;First inline cell&quot;</span>, row.getCell(<span class="number">0</span>).getStringCellValue());</span><br><span class="line">      assertEquals(<span class="string">&quot;First inline cell&quot;</span>, row.getCell(<span class="number">0</span>).getRichStringCellValue().getString());</span><br><span class="line">      assertEquals(<span class="string">&quot;Second inline cell&quot;</span>, row.getCell(<span class="number">1</span>).getStringCellValue());</span><br><span class="line">      assertEquals(<span class="string">&quot;Second inline cell&quot;</span>, row.getCell(<span class="number">1</span>).getRichStringCellValue().getString());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMissingRattrs</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">try</span>(</span><br><span class="line">        InputStream is = <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(<span class="string">&quot;src/test/resources/missing-r-attrs.xlsx&quot;</span>));</span><br><span class="line">        StreamingReader reader = StreamingReader.builder().read(is);</span><br><span class="line">    ) &#123;</span><br><span class="line">      Row row = reader.iterator().next();</span><br><span class="line">      assertEquals(<span class="number">0</span>, row.getRowNum());</span><br><span class="line">      assertEquals(<span class="string">&quot;1&quot;</span>, row.getCell(<span class="number">0</span>).getStringCellValue());</span><br><span class="line">      assertEquals(<span class="string">&quot;5&quot;</span>, row.getCell(<span class="number">4</span>).getStringCellValue());</span><br><span class="line">      row = reader.iterator().next();</span><br><span class="line">      assertEquals(<span class="number">1</span>, row.getRowNum());</span><br><span class="line">      assertEquals(<span class="string">&quot;6&quot;</span>, row.getCell(<span class="number">0</span>).getStringCellValue());</span><br><span class="line">      assertEquals(<span class="string">&quot;10&quot;</span>, row.getCell(<span class="number">4</span>).getStringCellValue());</span><br><span class="line">      row = reader.iterator().next();</span><br><span class="line">      assertEquals(<span class="number">6</span>, row.getRowNum());</span><br><span class="line">      assertEquals(<span class="string">&quot;11&quot;</span>, row.getCell(<span class="number">0</span>).getStringCellValue());</span><br><span class="line">      assertEquals(<span class="string">&quot;15&quot;</span>, row.getCell(<span class="number">4</span>).getStringCellValue());</span><br><span class="line"></span><br><span class="line">      assertFalse(reader.iterator().hasNext());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testClosingFiles</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    OPCPackage o = OPCPackage.open(<span class="keyword">new</span> File(<span class="string">&quot;src/test/resources/blank_cell_StringCellValue.xlsx&quot;</span>), PackageAccess.READ);</span><br><span class="line">    o.close();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shouldIgnoreSpreadsheetDrawingRows</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">try</span>(</span><br><span class="line">        InputStream is = <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(<span class="string">&quot;src/test/resources/has_spreadsheetdrawing.xlsx&quot;</span>));</span><br><span class="line">        Workbook wb = StreamingReader.builder().open(is);</span><br><span class="line">    ) &#123;</span><br><span class="line">      Iterator&lt;Row&gt; iterator = wb.getSheetAt(<span class="number">0</span>).iterator();</span><br><span class="line">      <span class="keyword">while</span>(iterator.hasNext()) &#123;</span><br><span class="line">        iterator.next();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testShouldReturnNullForMissingCellPolicy_RETURN_BLANK_AS_NULL</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">try</span>(</span><br><span class="line">        InputStream is = <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(<span class="string">&quot;src/test/resources/blank_cells.xlsx&quot;</span>));</span><br><span class="line">        Workbook wb = StreamingReader.builder().open(is);</span><br><span class="line">    ) &#123;</span><br><span class="line">      Row row = wb.getSheetAt(<span class="number">0</span>).iterator().next();</span><br><span class="line">      assertNotNull(row.getCell(<span class="number">0</span>, RETURN_BLANK_AS_NULL)); <span class="comment">//Remain unchanged</span></span><br><span class="line">      assertNull(row.getCell(<span class="number">1</span>, RETURN_BLANK_AS_NULL));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testShouldReturnBlankForMissingCellPolicy_CREATE_NULL_AS_BLANK</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">try</span>(</span><br><span class="line">        InputStream is = <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(<span class="string">&quot;src/test/resources/null_cell.xlsx&quot;</span>));</span><br><span class="line">        Workbook wb = StreamingReader.builder().open(is);</span><br><span class="line">    ) &#123;</span><br><span class="line">      Row row = wb.getSheetAt(<span class="number">0</span>).iterator().next();</span><br><span class="line">      assertEquals(<span class="string">&quot;B1 is Null -&gt;&quot;</span>, row.getCell(<span class="number">0</span>, CREATE_NULL_AS_BLANK).getStringCellValue()); <span class="comment">//Remain unchanged</span></span><br><span class="line">      assertEquals(<span class="string">&quot;B1 is Null -&gt;&quot;</span>, row.getCell(<span class="number">0</span>, CREATE_NULL_AS_BLANK).getRichStringCellValue().getString()); <span class="comment">//Remain unchanged</span></span><br><span class="line">      assertThat(row.getCell(<span class="number">1</span>), is(nullValue()));</span><br><span class="line">      assertNotNull(row.getCell(<span class="number">1</span>, CREATE_NULL_AS_BLANK));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Handle a file with a blank SST reference, like &lt;c r=&quot;L42&quot; s=&quot;1&quot; t=&quot;s&quot;&gt;&lt;v&gt;&lt;/v&gt;&lt;/c&gt;</span></span><br><span class="line">  <span class="comment">// Normally, if Excel saves the file, that whole &lt;c ...&gt;&lt;/c&gt; wouldn&#x27;t even be there.</span></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testShouldHandleBlankSSTReference</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">try</span>(</span><br><span class="line">        InputStream is = <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(<span class="string">&quot;src/test/resources/blank_sst_reference_doctored.xlsx&quot;</span>));</span><br><span class="line">        Workbook wb = StreamingReader.builder().open(is);</span><br><span class="line">    ) &#123;</span><br><span class="line">      Iterator&lt;Row&gt; iterator = wb.getSheetAt(<span class="number">0</span>).iterator();</span><br><span class="line">      <span class="keyword">while</span>(iterator.hasNext()) &#123;</span><br><span class="line">        iterator.next();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// The last cell on this sheet should be a NUMERIC but there is a lingering &quot;f&quot;</span></span><br><span class="line">  <span class="comment">// tag that was getting attached to the last cell causing it to be a FORUMLA.</span></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testForumulaOutsideCellIgnored</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">try</span>(</span><br><span class="line">        InputStream is = <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(<span class="string">&quot;src/test/resources/formula_outside_cell.xlsx&quot;</span>));</span><br><span class="line">        Workbook wb = StreamingReader.builder().open(is);</span><br><span class="line">    ) &#123;</span><br><span class="line">      Iterator&lt;Row&gt; rows = wb.getSheetAt(<span class="number">0</span>).iterator();</span><br><span class="line">      Cell cell = <span class="keyword">null</span>;</span><br><span class="line">      <span class="keyword">while</span>(rows.hasNext()) &#123;</span><br><span class="line">        Iterator&lt;Cell&gt; cells = rows.next().iterator();</span><br><span class="line">        <span class="keyword">while</span>(cells.hasNext()) &#123;</span><br><span class="line">            cell = cells.next();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      assertNotNull(cell);</span><br><span class="line">      assertThat(cell.getCellType(), is(CellType.NUMERIC));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFormulaWithDifferentTypes</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">try</span>(</span><br><span class="line">      InputStream is = <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(<span class="string">&quot;src/test/resources/formula_test.xlsx&quot;</span>));</span><br><span class="line">      Workbook wb = StreamingReader.builder().open(is)</span><br><span class="line">    ) &#123;</span><br><span class="line">      Sheet sheet = wb.getSheetAt(<span class="number">0</span>);</span><br><span class="line">      Iterator&lt;Row&gt; rowIterator = sheet.rowIterator();</span><br><span class="line"></span><br><span class="line">      Row next = rowIterator.next();</span><br><span class="line">      Cell cell = next.getCell(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">      assertThat(cell.getCellType(), is(CellType.STRING));</span><br><span class="line"></span><br><span class="line">      next = rowIterator.next();</span><br><span class="line">      cell = next.getCell(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">      assertThat(cell.getCellType(), is(CellType.FORMULA));</span><br><span class="line">      assertThat(cell.getCachedFormulaResultType(), is(CellType.STRING));</span><br><span class="line"></span><br><span class="line">      next = rowIterator.next();</span><br><span class="line">      cell = next.getCell(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">      assertThat(cell.getCellType(), is(CellType.FORMULA));</span><br><span class="line">      assertThat(cell.getCachedFormulaResultType(), is(CellType.BOOLEAN));</span><br><span class="line"></span><br><span class="line">      next = rowIterator.next();</span><br><span class="line">      cell = next.getCell(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">      assertThat(cell.getCellType(), is(CellType.FORMULA));</span><br><span class="line">      assertThat(cell.getCachedFormulaResultType(), is(CellType.NUMERIC));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testShouldIncrementColumnNumberIfExplicitCellAddressMissing</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	<span class="comment">// On consecutive columns the &lt;c&gt; element might miss an &quot;r&quot; attribute, which indicate the cell position.</span></span><br><span class="line">	<span class="comment">// This might be an optimization triggered by file size and specific to a particular excel version.</span></span><br><span class="line">	<span class="comment">// The excel would read such a file without complaining.</span></span><br><span class="line">    <span class="keyword">try</span>(</span><br><span class="line">        InputStream is = <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(<span class="string">&quot;src/test/resources/sparse-columns.xlsx&quot;</span>));</span><br><span class="line">        Workbook wb = StreamingReader.builder().open(is);</span><br><span class="line">    ) &#123;</span><br><span class="line">    	 Sheet sheet = wb.getSheetAt(<span class="number">0</span>);</span><br><span class="line">    	 </span><br><span class="line">    	 Iterator&lt;Row&gt; rowIterator = sheet.rowIterator();</span><br><span class="line">         Row row = rowIterator.next();</span><br><span class="line">         </span><br><span class="line">         assertThat(row.getCell(<span class="number">0</span>).getStringCellValue(), is(<span class="string">&quot;sparse&quot;</span>));</span><br><span class="line">         assertThat(row.getCell(<span class="number">3</span>).getStringCellValue(), is(<span class="string">&quot;columns&quot;</span>));</span><br><span class="line">         assertThat(row.getCell(<span class="number">4</span>).getNumericCellValue(), is(<span class="number">0.0</span>));</span><br><span class="line">         assertThat(row.getCell(<span class="number">5</span>).getNumericCellValue(), is(<span class="number">1.0</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="总结：-1"><a href="#总结：-1" class="headerlink" title="总结："></a>总结：</h4><p>因为我也没有仔细研究， 因为没有采用这个方式，但是 看了一下，应该不是 很难</p>
<h3 id="方案3：-阿里easyExcel"><a href="#方案3：-阿里easyExcel" class="headerlink" title="方案3： 阿里easyExcel"></a>方案3： 阿里easyExcel</h3><ul>
<li><p>最后说一下 使用阿里的easyExcel 的背景，我本来使用第一个方案 实现了 大文件的解析， 可是晚上接到电话，说 行内代码扫描说我的实现方式 存在安全漏洞，需要去修改 ，我震惊了，</p>
</li>
<li><p>但是还是想 了解一下原因,出现问题，分析问题，再解决问题嘛，解决不了咱在换个方案嘛，</p>
</li>
<li><p>但是又害怕 扭不到 行内的安全部门，所以得两手准备，一方面定位安全问题，一方面准备新方案 （ali easyexcel）</p>
</li>
</ul>
<h4 id="分析："><a href="#分析：" class="headerlink" title="分析："></a>分析：</h4><p>因为也是第一次使用easyExcel，再简单 看了下 说明文档后，大致知道我应该怎么用， 跟我想象中的使用方法还是有差别的 。可以说是开辟了一个新思路吧 </p>
<ul>
<li>我最开始本以为 api也会提供类似与分页的方式 ，来让用户取到数据，然后自行处理，后面发现并不是  ，以读操作为例，</li>
<li>我们需要继承 AnalysisEventListener 类，实现抽象方法，在抽象方法中写 自己的业务逻辑 。</li>
<li>read方法大部分的方法都是 void类型的 ，业务的逻辑都放在了 AnalysisEventListener 中去做，只有一个方法 </li>
</ul>
<p>以下的方法是： api中能为我们提供返回值 的方法，其实原理就是在自定义的listener（SyncReadListener）中新增一个类变量List<resultVO>，然后提供get 和set方法 ，每一条rowData都会经过 invoke 方法，每次处理成功之后，就将invoke处理过后的数据，加入 list，最后 我们就可以拿到 返回值了， </p>
<ul>
<li>其实按照类似的思路，我们也可以自己实现一个带有分页功能的 Listener ，然后对外提供 分页能力，思路大概是： </li>
<li><ul>
<li>新建builder 继承  AbstractExcelReaderParameterBuilder 新增分页方法， </li>
<li>新建类 factory 继承 EasyExcelFactory ，新增分页方法</li>
</ul>
</li>
</ul>
<p>但是感觉好像确实没必要，毕竟我们拿到返回的list<excelVO>，我们还是需要 逐条解析逐条处理。 我们的业务 处理逻辑完全可以写在  listener 里面提供的2个方法  invoke 和 doAfterAllAnalysed 里面 。</p>
<p>** 嘿嘿，没事给自己找事，下次写一个玩玩吧 （TODO tocheck）**</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Quickly read small files，no more than 10,000 lines.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> in</span></span><br><span class="line"><span class="comment">     *            the POI filesystem that contains the Workbook stream.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sheet</span></span><br><span class="line"><span class="comment">     *            read sheet.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> analysis result.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@deprecated</span> please use &#x27;EasyExcel.read(in).sheet(sheetNo).doReadSync();&#x27;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Deprecated</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Object&gt; <span class="title">read</span><span class="params">(InputStream in, Sheet sheet)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> List&lt;Object&gt; rows = <span class="keyword">new</span> ArrayList&lt;Object&gt;();</span><br><span class="line">        <span class="keyword">new</span> ExcelReader(in, <span class="keyword">null</span>, <span class="keyword">new</span> AnalysisEventListener&lt;Object&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">invoke</span><span class="params">(Object object, AnalysisContext context)</span> </span>&#123;</span><br><span class="line">                rows.add(object);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfterAllAnalysed</span><span class="params">(AnalysisContext context)</span> </span>&#123;&#125;</span><br><span class="line">        &#125;, <span class="keyword">false</span>).read(sheet);</span><br><span class="line">        <span class="keyword">return</span> rows;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExcelReaderSheetBuilder</span> <span class="keyword">extends</span> <span class="title">AbstractExcelReaderParameterBuilder</span>&lt;<span class="title">ExcelReaderSheetBuilder</span>, <span class="title">ReadSheet</span>&gt; </span>&#123;</span><br><span class="line">    </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Synchronous reads return results</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">List&lt;T&gt; <span class="title">doReadSync</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (excelReader == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ExcelAnalysisException(<span class="string">&quot;Must use &#x27;EasyExcelFactory.read().sheet()&#x27; to call this method&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        SyncReadListener syncReadListener = <span class="keyword">new</span> SyncReadListener();</span><br><span class="line">        registerReadListener(syncReadListener);</span><br><span class="line">        excelReader.read(build());</span><br><span class="line">        excelReader.finish();</span><br><span class="line">        <span class="keyword">return</span> (List&lt;T&gt;)syncReadListener.getList();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Synchronous data reading</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Jiaju Zhuang</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SyncReadListener</span> <span class="keyword">extends</span> <span class="title">AnalysisEventListener</span>&lt;<span class="title">Object</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Object&gt; list = <span class="keyword">new</span> ArrayList&lt;Object&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">invoke</span><span class="params">(Object object, AnalysisContext context)</span> </span>&#123;</span><br><span class="line">        list.add(object);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfterAllAnalysed</span><span class="params">(AnalysisContext context)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Object&gt; <span class="title">getList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setList</span><span class="params">(List&lt;Object&gt; list)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.list = list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="需求："><a href="#需求：" class="headerlink" title="需求："></a>需求：</h4><p>讲了一堆，进入正题吧，我的业务逻辑  有4点：</p>
<ol>
<li>需要校验头文件 headerTItle 的正确性，如果 valid不通过，需要直接抛出异常，不进行后续解析操作 </li>
<li>需要校验每条数据的 正确性</li>
<li>需要将正确的数据 批量插入数据库中</li>
<li>需要将错误数据写在 ErrorData写在 excel 里面</li>
</ol>
<h4 id="实现："><a href="#实现：" class="headerlink" title="实现："></a>实现：</h4><ol>
<li>关于校验头文件，业务需求使得我们 需要单独 新建一个 HeaderTitleValidListener，在  单纯的只是 checkheader，不做其他操作,校验不通过就抛出异常，中断解析操作</li>
<li> 关于每条数据的正确性，我们需要再新增一个 XXDataListener ，然后我们可以自行封装 一个 业务逻辑的 XXvalidtor ，方法就是 checkData，返回值就是 错误信息，这个需要写入excel的</li>
<li> 正确数据的处理，放在 listener的 invoke 方法中，新增一个类变量 greenDataCacheList，用于存储正确的数据，定义一个常量 COMMIT_COUNT=2000，当 greenDataCacheList 的size= COMMIT_COUNT ，我们就执行一个插入数据库的工作，然后clear greenDataCacheList的数据</li>
<li>将错误数据写在 ErrorData写在 excel 里面，这个其实可以放在 doAfterAllAnalysed里面去做，当然也可以同样的方式放在 invoke 方法里面去做 </li>
</ol>
<p>思路清晰了，实现起来就很简单了 </p>
<h4 id="依赖包-2"><a href="#依赖包-2" class="headerlink" title="依赖包"></a>依赖包</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/easyexcel --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;easyexcel&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.2.6&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- https://mvnrepository.com/artifact/com.monitorjbl/xlsx-streamer --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.monitorjbl&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;xlsx-streamer&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.1.0&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;joda-time&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;joda-time&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.9.8&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!-- apache poi 操作Microsoft Document --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;poi&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.17&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!-- Apache POI - Java API To Access Microsoft Format Files--&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;poi-ooxml&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.17&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- Apache POI - Java API To Access Microsoft Format Files--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;poi-ooxml-schemas&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.17&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!-- poi eventmodel方式 依赖包 --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;xerces&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;xercesImpl&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.11.0&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>



<h4 id="自定义LIstener"><a href="#自定义LIstener" class="headerlink" title="自定义LIstener"></a>自定义LIstener</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yinshi.gitstats.poi.sax.easyexcel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.exception.ExcelCommonException;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.context.AnalysisContext;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.event.AnalysisEventListener;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeaderTitleValidListener</span> <span class="keyword">extends</span> <span class="title">AnalysisEventListener</span>&lt;<span class="title">TmCase</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(HeaderTitleValidListener.class);</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 每隔5条存储数据库，实际使用中可以3000条，然后清理list ，方便内存回收</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BATCH_COUNT = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">invokeHeadMap</span><span class="params">(Map&lt;Integer, String&gt; headMap, AnalysisContext context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!isValidHeadertitle(headMap)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ExcelCommonException(<span class="string">&quot;头文件异常&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        LOGGER.info(<span class="string">&quot;HEAD:&#123;&#125;&quot;</span>, JSON.toJSONString(headMap));</span><br><span class="line">        LOGGER.info(<span class="string">&quot;total:&#123;&#125;&quot;</span>, context.readSheetHolder().getTotal());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * true： 通过</span></span><br><span class="line"><span class="comment">     * false：  未通过</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> headMap</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isValidHeadertitle</span><span class="params">(Map&lt;Integer, String&gt; headMap)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> String[] ORGIN_HEADERTITLE = &#123;<span class="string">&quot;姓名&quot;</span>, <span class="string">&quot;年龄&quot;</span>&#125;;</span><br><span class="line">        List&lt;String&gt; ORGIN_HEADERTITLE_List = Arrays.asList(ORGIN_HEADERTITLE);</span><br><span class="line">        <span class="comment">//TODO 校验逻辑</span></span><br><span class="line">        <span class="comment">// 1. 校验excel的头文件是否为空</span></span><br><span class="line">        <span class="comment">// 2. 校验excel的头文件 的长度 headMap.entrySet().size  ORGIN_HEADERTITLE_List.size</span></span><br><span class="line">        <span class="comment">// 3. 校验excel的头文件 every item</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 每条shuju</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data</span></span><br><span class="line"><span class="comment">     *            one row value. Is is same as &#123;<span class="doctag">@link</span> AnalysisContext#readRowHolder()&#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">invoke</span><span class="params">(TmCase data, AnalysisContext context)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// donothing</span></span><br><span class="line"><span class="comment">//        LOGGER.info(&quot;index:&#123;&#125;&quot;, context.readRowHolder().getRowIndex());</span></span><br><span class="line"><span class="comment">//        LOGGER.info(&quot;解析到一条数据:&#123;&#125;&quot;, JSON.toJSONString(data));</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfterAllAnalysed</span><span class="params">(AnalysisContext context)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// donothing</span></span><br><span class="line"><span class="comment">//        LOGGER.info(&quot;所有数据解析完成！&quot;);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/////////////////////////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">///// 分界线</span></span><br><span class="line"><span class="comment">/////////////////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="keyword">package</span> com.yinshi.gitstats.poi.sax.easyexcel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.context.AnalysisContext;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.event.AnalysisEventListener;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.yinshi.gitstats.entity.TmCase;</span><br><span class="line"><span class="keyword">import</span> org.junit.Assert;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LargeDataListener</span> <span class="keyword">extends</span> <span class="title">AnalysisEventListener</span>&lt;<span class="title">TmCase</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(LargeDataListener.class);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 每隔5条存储数据库，实际使用中可以3000条，然后清理list ，方便内存回收</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BATCH_COUNT = <span class="number">2000</span>;</span><br><span class="line">    <span class="keyword">private</span> List&lt;TmCase&gt; greenDataList = <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">invoke</span><span class="params">(TmCase data, AnalysisContext context)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1. 如果 greenDataList大小==BATCH_COUNT ，则插入数据库，然后 greenDataList.clear</span></span><br><span class="line">        <span class="comment">// 2. 执行数据校验Validtor，校验通过，greenDataList.add</span></span><br><span class="line">        <span class="comment">// 3. Validtor校验不通过，则将 errorMsg ,set到对象中</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfterAllAnalysed</span><span class="params">(AnalysisContext context)</span> </span>&#123;</span><br><span class="line">        LOGGER.info(<span class="string">&quot;Large row count:&#123;&#125;&quot;</span>, count);</span><br><span class="line">        <span class="comment">// 将错误数据写入 excel</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">///////////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">///////////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="keyword">package</span> com.yinshi.gitstats.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.annotation.ExcelIgnore;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.annotation.ExcelProperty;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Table(name = &quot;tm_case&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TmCase</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 序列化ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">4112999956266472980L</span>;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line">    <span class="meta">@ExcelIgnore</span></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;id&quot;, columnDefinition = &quot;BIGINT&quot;)</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    @ExcelProperty(index = 2, converter = GenderConverter.class)</span></span><br><span class="line">    <span class="meta">@ExcelProperty(index = 0)</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;loanNo&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String loanNo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(index = 1)</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;colDateStr&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String colDateStr;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(index = 2)</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;colType&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String colType;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(index = 3)</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;colPerson&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String colPerson;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(index = 4)</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;colAddress&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String colAddress;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(index = 5)</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;colStatus&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String colStatus;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(index = 6)</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;concreteColContent&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String concreteColContent;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(index = 7)</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;repayDateStr&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String repayDateStr;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(index = 8)</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;repayAmtStr&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String repayAmtStr;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(index = 9)</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;errorMsg&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String errorMsg;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="总结：-2"><a href="#总结：-2" class="headerlink" title="总结："></a>总结：</h4><ul>
<li><p>写的都是伪代码，思路提供了，自行实现吧 ，代码都在公司上，自己电脑只是验证可行性 </p>
</li>
<li><p>可以多看看 easyExcel的 源码，还是很nice的 </p>
<table>
<thead>
<tr>
<th>origin</th>
<th><a target="_blank" rel="noopener" href="https://github.com/alibaba/easyexcel.git">https://github.com/alibaba/easyexcel.git</a></th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
</li>
</ul>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>最终通过实验，我们比较一下这写方案的性能差异：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">//参数自行改动</span></span><br><span class="line"> <span class="comment">// VM:  -Xmx40M -Xms40M -XX:+PrintGCDetails -XX:+PrintHeapAtGC</span></span><br><span class="line"><span class="comment">//        readXlsxTest();</span></span><br><span class="line"><span class="comment">//        testSAX();</span></span><br><span class="line">        testEasyExcel();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testEasyExcel</span><span class="params">()</span></span>&#123;</span><br><span class="line">        File file = <span class="keyword">new</span> File(<span class="string">&quot;/home/yinshi/Documents/CodeSource/test-write071.xlsx&quot;</span>);</span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">        EasyExcel.read(file, TmCase.class,</span><br><span class="line">                <span class="keyword">new</span> LargeDataListener()).headRowNumber(<span class="number">2</span>).sheet().doRead();</span><br><span class="line">        System.out.println(<span class="string">&quot;Large data total time spent:&quot;</span>+ (System.currentTimeMillis() - start));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testSAX</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        File file = <span class="keyword">new</span> File(<span class="string">&quot;/home/yinshi/Documents/CodeSource/test-write071.xlsx&quot;</span>);</span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        List&lt;TmCase&gt; myDataList = new MyExcel2007ForPaging_high_baK_bak(file.getPath(), 10, 2, 50001).</span></span><br><span class="line"><span class="comment">//                getMyDataList(new TmCaseExcelResultHandler());</span></span><br><span class="line">        ReaderSaxPOIUtils&lt;TmCase&gt; utils = <span class="keyword">new</span> ReaderSaxPOIUtils&lt;TmCase&gt;(<span class="keyword">new</span> TmCaseExcelResultHandler());</span><br><span class="line">        List&lt;TmCase&gt; pagingData = utils.getPagingData(file, <span class="number">1</span>, <span class="number">2000</span>, <span class="number">50001</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (TmCase tmCase : pagingData) &#123;</span><br><span class="line">            System.out.println(tmCase.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 读取以 .xlsx 为后缀的 Excel 测试</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException 文件操作异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">readXlsxTest</span><span class="params">()</span> <span class="keyword">throws</span> IOException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 读取 Excel 文件</span></span><br><span class="line">        <span class="comment">// 获取文件路径和文件</span></span><br><span class="line">        File file = <span class="keyword">new</span> File(<span class="string">&quot;/home/yinshi/Documents/CodeSource/test-write071.xlsx&quot;</span>);</span><br><span class="line"></span><br><span class="line">        FileInputStream fis = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">        <span class="comment">// 将输入流转换为工作簿对象</span></span><br><span class="line">        XSSFWorkbook workbook = <span class="keyword">new</span> XSSFWorkbook(fis);</span><br><span class="line">        <span class="comment">// 获取第一个工作表</span></span><br><span class="line"><span class="comment">//        XSSFSheet sheet = workbook.getSheet(&quot;sheet0&quot;);</span></span><br><span class="line">        <span class="comment">// 使用索引获取工作表</span></span><br><span class="line">        XSSFSheet sheet = workbook.getSheetAt(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">// 获取指定行</span></span><br><span class="line">        XSSFRow row = sheet.getRow(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">// 获取指定列</span></span><br><span class="line">        XSSFCell cell = row.getCell(<span class="number">2</span>);</span><br><span class="line">        <span class="comment">// 打印</span></span><br><span class="line">        System.out.println(cell.getStringCellValue());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<p><img src="/uploads/poiJVM/excelSize.png"></p>
<p><img src="/uploads/poiJVM/userModelJVM.png"></p>
<p><img src="/uploads/poiJVM/SaxPOI_JVMparams.png"></p>
<p><img src="/uploads/poiJVM/ali_easyExcel_JVM.png"></p>
<p>计算一下，excel 大小为 2.1 M</p>
<p>用户模式需要： 新生代used + 老年代used = (23327+30563 )/1024= 52.6M</p>
<p>sax事件驱动模式： （9408+31764 ） /1024=  40.2 M</p>
<p>阿里easyExcel：（8699+15950）/1024=24.07 M</p>
<p>所以………………厉害</p>
<p><strong>这边再贴一下关于 streamReader  和 sax的解析xml 的安全问题的 源头，以及解决方案</strong></p>
<p>ref : <a target="_blank" rel="noopener" href="https://www.dazhuanlan.com/2020/02/02/5e36a1acefeea/">https://www.dazhuanlan.com/2020/02/02/5e36a1acefeea/</a></p>

    </div>

    
    
    
      


    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>Yinshi
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://limingzhang666.github.io/2021/03/28/%E8%AF%BB%E5%8F%96poi%E5%A4%A7%E6%96%87%E4%BB%B6%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E6%A1%88/" title="读取poi大文件的两种方案">https://limingzhang666.github.io/2021/03/28/读取poi大文件的两种方案/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/%E8%AF%BB%E5%8F%96%E5%A4%A7%E6%96%87%E4%BB%B6/" rel="tag"># 读取大文件</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/03/15/2021todoList/" rel="prev" title="2021todoList">
                  <i class="fa fa-chevron-left"></i> 2021todoList
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/04/07/java%E9%AB%98%E5%B9%B6%E5%8F%91%E8%AF%A6%E8%A7%A3-16-Future%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="next" title="java高并发详解-16-Future设计模式">
                  java高并发详解-16-Future设计模式 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






      
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  &copy; 2020 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yinshi</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>




  <script src="/js/local-search.js"></script>










<script>
if (document.querySelectorAll('.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8.8.2/dist/mermaid.min.js', () => {
    mermaid.init({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    }, '.mermaid');
  }, window.mermaid);
}
</script>





  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>








  

  

<script>
NexT.utils.loadComments('#valine-comments', () => {
  NexT.utils.getScript('https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', () => {
    new Valine(Object.assign({"enable":true,"appId":"4oBiQGiWDHdACABLWjT7ouaV-gzGzoHsz","appKey":"fr4vMSPUjcHLtIrF2hmRF6UE","serverURLs":"https://4obiqgiw.lc-cn-n1-shared.com","placeholder":"国王不动，手下怎么跟随? --反叛的鲁鲁修","avatar":"","meta":["nick","mail","link"],"pageSize":10,"lang":null,"visitor":false,"comment_count":true,"recordIP":true,"enableQQ":true,"requiredFields":[],"cdh":"https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js"}, {
      el: '#valine-comments',
      path: "/2021/03/28/%E8%AF%BB%E5%8F%96poi%E5%A4%A7%E6%96%87%E4%BB%B6%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E6%A1%88/",
      serverURLs: "https://4obiqgiw.lc-cn-n1-shared.com"
    }));
  }, window.Valine);
});
</script>


</body>
</html>
